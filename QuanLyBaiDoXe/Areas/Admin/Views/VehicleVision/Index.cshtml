@{
    ViewData["Title"] = "Giám sát bãi đỗ xe";
}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">Giám sát bãi đỗ xe</h1>
        <div class="breadcrumb">
            <a href="#">Trang chủ</a>
            <span>/</span>
            <span>Giám sát bãi</span>
        </div>
    </div>
    <div>
        <button class="btn-primary-admin" id="btnVirtualMap">
            <i class="fas fa-map-marked-alt"></i>
            Xem map ảo
        </button>
        <button class="btn-primary-admin" id="btnRefresh">
            <i class="fas fa-sync-alt"></i>
            Làm mới
        </button>
        <button class="btn-secondary-admin" id="btnSettings">
            <i class="fas fa-cog"></i>
            Cài đặt
        </button>
    </div>
</div>

<!-- Stat Cards -->
<div class="stat-cards">
    <div class="stat-card">
        <div class="stat-card-icon teal">
            <i class="fas fa-parking"></i>
        </div>
        <div class="stat-card-info">
            <h3>156/220</h3>
            <p>Tổng số chỗ đỗ</p>
        </div>
        <div class="stat-card-trend up">
            <i class="fas fa-circle"></i>
            70.9%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon green">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-card-info">
            <h3>64</h3>
            <p>Chỗ trống</p>
        </div>
        <div class="stat-card-trend up">
            <i class="fas fa-arrow-up"></i>
            29.1%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon orange">
            <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="stat-card-info">
            <h3 id="activeGatesCount">0/4</h3>
            <p>Chốt kiểm soát</p>
        </div>
        <div class="stat-card-trend" id="activeGatesTrend">
            <i class="fas fa-circle"></i>
            <span id="activeGatesStatus">Tất cả đóng</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon teal">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-card-info">
            <h3>4.2h</h3>
            <p>Thời gian gửi TB</p>
        </div>
        <div class="stat-card-trend down">
            <i class="fas fa-arrow-down"></i>
            12.3%
        </div>
    </div>
</div>

<div class="row">
    <!-- Parking Lot Map -->
    <div class="col-lg-8">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Sơ đồ bãi đỗ xe</h3>
                <div>
                    <button class="btn-secondary-admin btn-sm" id="btnZoomIn">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="btn-secondary-admin btn-sm" id="btnZoomOut">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="btn-primary-admin btn-sm" id="btnFullscreen">
                        <i class="fas fa-expand"></i>
                        Toàn màn hình
                    </button>
                </div>
            </div>
            <div style="padding: 20px;">
                <!-- Checkpoint Gates -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 12px 20px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 10px; flex: 1; margin-right: 10px;">
                        <i class="fas fa-sign-in-alt" style="font-size: 24px;"></i>
                        <div>
                            <div style="font-size: 12px; opacity: 0.9;">Chốt vào 1</div>
                            <div style="font-weight: bold; font-size: 18px;">12 xe/h</div>
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 12px 20px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 10px; flex: 1; margin-right: 10px;">
                        <i class="fas fa-sign-in-alt" style="font-size: 24px;"></i>
                        <div>
                            <div style="font-size: 12px; opacity: 0.9;">Chốt vào 2</div>
                            <div style="font-weight: bold; font-size: 18px;">8 xe/h</div>
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 12px 20px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 10px; flex: 1; margin-right: 10px;">
                        <i class="fas fa-sign-out-alt" style="font-size: 24px;"></i>
                        <div>
                            <div style="font-size: 12px; opacity: 0.9;">Chốt ra 1</div>
                            <div style="font-weight: bold; font-size: 18px;">10 xe/h</div>
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); padding: 12px 20px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 10px; flex: 1;">
                        <i class="fas fa-sign-out-alt" style="font-size: 24px;"></i>
                        <div>
                            <div style="font-size: 12px; opacity: 0.9;">Chốt ra 2</div>
                            <div style="font-weight: bold; font-size: 18px;">9 xe/h</div>
                        </div>
                    </div>
                </div>

                <!-- Parking Grid -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 2px solid #e0e0e0;" id="parkingMapContainer">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div style="font-weight: bold; color: #333;">KHU A - Xe máy</div>
                        <div style="font-size: 13px; color: #666;">60 chỗ</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(12, 1fr); gap: 8px; margin-bottom: 25px;">
                        <!-- Row 1 -->
                        <div class="parking-spot occupied" title="A01 - Đã đỗ">1</div>
                        <div class="parking-spot occupied" title="A02 - Đã đỗ">2</div>
                        <div class="parking-spot available" title="A03 - Trống">3</div>
                        <div class="parking-spot occupied" title="A04 - Đã đỗ">4</div>
                        <div class="parking-spot occupied" title="A05 - Đã đỗ">5</div>
                        <div class="parking-spot available" title="A06 - Trống">6</div>
                        <div class="parking-spot occupied" title="A07 - Đã đỗ">7</div>
                        <div class="parking-spot occupied" title="A08 - Đã đỗ">8</div>
                        <div class="parking-spot available" title="A09 - Trống">9</div>
                        <div class="parking-spot occupied" title="A10 - Đã đỗ">10</div>
                        <div class="parking-spot available" title="A11 - Trống">11</div>
                        <div class="parking-spot occupied" title="A12 - Đã đỗ">12</div>
                        <!-- Row 2 -->
                        <div class="parking-spot occupied" title="A13 - Đã đỗ">13</div>
                        <div class="parking-spot available" title="A14 - Trống">14</div>
                        <div class="parking-spot occupied" title="A15 - Đã đỗ">15</div>
                        <div class="parking-spot occupied" title="A16 - Đã đỗ">16</div>
                        <div class="parking-spot available" title="A17 - Trống">17</div>
                        <div class="parking-spot occupied" title="A18 - Đã đỗ">18</div>
                        <div class="parking-spot occupied" title="A19 - Đã đỗ">19</div>
                        <div class="parking-spot available" title="A20 - Trống">20</div>
                        <div class="parking-spot occupied" title="A21 - Đã đỗ">21</div>
                        <div class="parking-spot available" title="A22 - Trống">22</div>
                        <div class="parking-spot occupied" title="A23 - Đã đỗ">23</div>
                        <div class="parking-spot occupied" title="A24 - Đã đỗ">24</div>
                        <!-- Row 3 -->
                        <div class="parking-spot available" title="A25 - Trống">25</div>
                        <div class="parking-spot occupied" title="A26 - Đã đỗ">26</div>
                        <div class="parking-spot occupied" title="A27 - Đã đỗ">27</div>
                        <div class="parking-spot available" title="A28 - Trống">28</div>
                        <div class="parking-spot occupied" title="A29 - Đã đỗ">29</div>
                        <div class="parking-spot occupied" title="A30 - Đã đỗ">30</div>
                        <div class="parking-spot available" title="A31 - Trống">31</div>
                        <div class="parking-spot occupied" title="A32 - Đã đỗ">32</div>
                        <div class="parking-spot occupied" title="A33 - Đã đỗ">33</div>
                        <div class="parking-spot available" title="A34 - Trống">34</div>
                        <div class="parking-spot occupied" title="A35 - Đã đỗ">35</div>
                        <div class="parking-spot occupied" title="A36 - Đã đỗ">36</div>
                        <!-- Row 4 -->
                        <div class="parking-spot occupied" title="A37 - Đã đỗ">37</div>
                        <div class="parking-spot available" title="A38 - Trống">38</div>
                        <div class="parking-spot occupied" title="A39 - Đã đỗ">39</div>
                        <div class="parking-spot occupied" title="A40 - Đã đỗ">40</div>
                        <div class="parking-spot available" title="A41 - Trống">41</div>
                        <div class="parking-spot occupied" title="A42 - Đã đỗ">42</div>
                        <div class="parking-spot occupied" title="A43 - Đã đỗ">43</div>
                        <div class="parking-spot available" title="A44 - Trống">44</div>
                        <div class="parking-spot occupied" title="A45 - Đã đỗ">45</div>
                        <div class="parking-spot occupied" title="A46 - Đã đỗ">46</div>
                        <div class="parking-spot available" title="A47 - Trống">47</div>
                        <div class="parking-spot occupied" title="A48 - Đã đỗ">48</div>
                        <!-- Row 5 -->
                        <div class="parking-spot available" title="A49 - Trống">49</div>
                        <div class="parking-spot occupied" title="A50 - Đã đỗ">50</div>
                        <div class="parking-spot occupied" title="A51 - Đã đỗ">51</div>
                        <div class="parking-spot available" title="A52 - Trống">52</div>
                        <div class="parking-spot occupied" title="A53 - Đã đỗ">53</div>
                        <div class="parking-spot occupied" title="A54 - Đã đỗ">54</div>
                        <div class="parking-spot available" title="A55 - Trống">55</div>
                        <div class="parking-spot occupied" title="A56 - Đã đỗ">56</div>
                        <div class="parking-spot occupied" title="A57 - Đã đỗ">57</div>
                        <div class="parking-spot available" title="A58 - Trống">58</div>
                        <div class="parking-spot occupied" title="A59 - Đã đỗ">59</div>
                        <div class="parking-spot occupied" title="A60 - Đã đỗ">60</div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div style="font-weight: bold; color: #333;">KHU B - Ô tô</div>
                        <div style="font-size: 13px; color: #666;">40 chỗ</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 10px; margin-bottom: 25px;">
                        <!-- Row 1 -->
                        <div class="parking-spot car occupied" title="B01 - Đã đỗ">1</div>
                        <div class="parking-spot car occupied" title="B02 - Đã đỗ">2</div>
                        <div class="parking-spot car available" title="B03 - Trống">3</div>
                        <div class="parking-spot car occupied" title="B04 - Đã đỗ">4</div>
                        <div class="parking-spot car available" title="B05 - Trống">5</div>
                        <div class="parking-spot car occupied" title="B06 - Đã đỗ">6</div>
                        <div class="parking-spot car occupied" title="B07 - Đã đỗ">7</div>
                        <div class="parking-spot car available" title="B08 - Trống">8</div>
                        <div class="parking-spot car occupied" title="B09 - Đã đỗ">9</div>
                        <div class="parking-spot car occupied" title="B10 - Đã đỗ">10</div>
                        <!-- Row 2 -->
                        <div class="parking-spot car available" title="B11 - Trống">11</div>
                        <div class="parking-spot car occupied" title="B12 - Đã đỗ">12</div>
                        <div class="parking-spot car occupied" title="B13 - Đã đỗ">13</div>
                        <div class="parking-spot car available" title="B14 - Trống">14</div>
                        <div class="parking-spot car occupied" title="B15 - Đã đỗ">15</div>
                        <div class="parking-spot car occupied" title="B16 - Đã đỗ">16</div>
                        <div class="parking-spot car available" title="B17 - Trống">17</div>
                        <div class="parking-spot car occupied" title="B18 - Đã đỗ">18</div>
                        <div class="parking-spot car available" title="B19 - Trống">19</div>
                        <div class="parking-spot car occupied" title="B20 - Đã đỗ">20</div>
                        <!-- Row 3 -->
                        <div class="parking-spot car occupied" title="B21 - Đã đỗ">21</div>
                        <div class="parking-spot car available" title="B22 - Trống">22</div>
                        <div class="parking-spot car occupied" title="B23 - Đã đỗ">23</div>
                        <div class="parking-spot car occupied" title="B24 - Đã đỗ">24</div>
                        <div class="parking-spot car available" title="B25 - Trống">25</div>
                        <div class="parking-spot car occupied" title="B26 - Đã đỗ">26</div>
                        <div class="parking-spot car occupied" title="B27 - Đã đỗ">27</div>
                        <div class="parking-spot car available" title="B28 - Trống">28</div>
                        <div class="parking-spot car occupied" title="B29 - Đã đỗ">29</div>
                        <div class="parking-spot car occupied" title="B30 - Đã đỗ">30</div>
                        <!-- Row 4 -->
                        <div class="parking-spot car available" title="B31 - Trống">31</div>
                        <div class="parking-spot car occupied" title="B32 - Đã đỗ">32</div>
                        <div class="parking-spot car occupied" title="B33 - Đã đỗ">33</div>
                        <div class="parking-spot car available" title="B34 - Trống">34</div>
                        <div class="parking-spot car occupied" title="B35 - Đã đỗ">35</div>
                        <div class="parking-spot car available" title="B36 - Trống">36</div>
                        <div class="parking-spot car occupied" title="B37 - Đã đỗ">37</div>
                        <div class="parking-spot car occupied" title="B38 - Đã đỗ">38</div>
                        <div class="parking-spot car available" title="B39 - Trống">39</div>
                        <div class="parking-spot car occupied" title="B40 - Đã đỗ">40</div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div style="font-weight: bold; color: #333;">KHU C - Xe tải</div>
                        <div style="font-size: 13px; color: #666;">20 chỗ</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 10px;">
                        <!-- Row 1 -->
                        <div class="parking-spot truck occupied" title="C01 - Đã đỗ">1</div>
                        <div class="parking-spot truck available" title="C02 - Trống">2</div>
                        <div class="parking-spot truck occupied" title="C03 - Đã đỗ">3</div>
                        <div class="parking-spot truck occupied" title="C04 - Đã đỗ">4</div>
                        <div class="parking-spot truck available" title="C05 - Trống">5</div>
                        <div class="parking-spot truck occupied" title="C06 - Đã đỗ">6</div>
                        <div class="parking-spot truck occupied" title="C07 - Đã đỗ">7</div>
                        <div class="parking-spot truck available" title="C08 - Trống">8</div>
                        <div class="parking-spot truck occupied" title="C09 - Đã đỗ">9</div>
                        <div class="parking-spot truck occupied" title="C10 - Đã đỗ">10</div>
                        <!-- Row 2 -->
                        <div class="parking-spot truck available" title="C11 - Trống">11</div>
                        <div class="parking-spot truck occupied" title="C12 - Đã đỗ">12</div>
                        <div class="parking-spot truck occupied" title="C13 - Đã đỗ">13</div>
                        <div class="parking-spot truck available" title="C14 - Trống">14</div>
                        <div class="parking-spot truck occupied" title="C15 - Đã đỗ">15</div>
                        <div class="parking-spot truck available" title="C16 - Trống">16</div>
                        <div class="parking-spot truck occupied" title="C17 - Đã đỗ">17</div>
                        <div class="parking-spot truck occupied" title="C18 - Đã đỗ">18</div>
                        <div class="parking-spot truck available" title="C19 - Trống">19</div>
                        <div class="parking-spot truck occupied" title="C20 - Đã đỗ">20</div>
                    </div>

                    <!-- Legend -->
                    <div style="display: flex; gap: 20px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #e74c3c; border-radius: 4px;"></div>
                            <span style="font-size: 13px;">Đã đỗ</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #27ae60; border-radius: 4px;"></div>
                            <span style="font-size: 13px;">Trống</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #95a5a6; border-radius: 4px;"></div>
                            <span style="font-size: 13px;">Bảo trì</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Real-time Activities & Controls -->
    <div class="col-lg-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Hoạt động thời gian thực</h3>
                <span class="status-badge success">
                    <i class="fas fa-circle" style="animation: pulse 2s infinite;"></i>
                    Trực tuyến
                </span>
            </div>
            <div style="max-height: 300px; overflow-y: auto;">
                <div class="activity-item">
                    <div style="width: 40px; height: 40px; background-color: rgba(39, 174, 96, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-sign-in-alt" style="color: #27ae60;"></i>
                    </div>
                    <div style="flex: 1; margin-left: 12px;">
                        <div style="font-weight: 500; font-size: 14px;">59A1-12345</div>
                        <div style="font-size: 12px; color: var(--light-gray);">Xe vào - Chốt 1</div>
                    </div>
                    <div style="font-size: 12px; color: var(--light-gray);">2 phút trước</div>
                </div>
                <div class="activity-item">
                    <div style="width: 40px; height: 40px; background-color: rgba(231, 76, 60, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-sign-out-alt" style="color: #e74c3c;"></i>
                    </div>
                    <div style="flex: 1; margin-left: 12px;">
                        <div style="font-weight: 500; font-size: 14px;">30A-56789</div>
                        <div style="font-size: 12px; color: var(--light-gray);">Xe ra - Chốt 2</div>
                    </div>
                    <div style="font-size: 12px; color: var(--light-gray);">5 phút trước</div>
                </div>
                <div class="activity-item">
                    <div style="width: 40px; height: 40px; background-color: rgba(39, 174, 96, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-sign-in-alt" style="color: #27ae60;"></i>
                    </div>
                    <div style="flex: 1; margin-left: 12px;">
                        <div style="font-weight: 500; font-size: 14px;">29B1-98765</div>
                        <div style="font-size: 12px; color: var(--light-gray);">Xe vào - Chốt 2</div>
                    </div>
                    <div style="font-size: 12px; color: var(--light-gray);">8 phút trước</div>
                </div>
                <div class="activity-item">
                    <div style="width: 40px; height: 40px; background-color: rgba(231, 76, 60, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-sign-out-alt" style="color: #e74c3c;"></i>
                    </div>
                    <div style="flex: 1; margin-left: 12px;">
                        <div style="font-weight: 500; font-size: 14px;">51G-11111</div>
                        <div style="font-size: 12px; color: var(--light-gray);">Xe ra - Chốt 1</div>
                    </div>
                    <div style="font-size: 12px; color: var(--light-gray);">12 phút trước</div>
                </div>
                <div class="activity-item">
                    <div style="width: 40px; height: 40px; background-color: rgba(39, 174, 96, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-sign-in-alt" style="color: #27ae60;"></i>
                    </div>
                    <div style="flex: 1; margin-left: 12px;">
                        <div style="font-weight: 500; font-size: 14px;">30E-22222</div>
                        <div style="font-size: 12px; color: var(--light-gray);">Xe vào - Chốt 1</div>
                    </div>
                    <div style="font-size: 12px; color: var(--light-gray);">15 phút trước</div>
                </div>
            </div>
        </div>

        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Điều khiển chốt</h3>
            </div>
            <div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 500;">Chốt vào 1</div>
                            <div style="font-size: 12px; color: var(--light-gray);">Cổng chính</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn-primary-admin btn-sm btn-open-gate" data-checkpoint="entry1" data-status="closed">
                                <i class="fas fa-unlock"></i>
                                Mở
                            </button>
                            <button class="btn-danger-admin btn-sm btn-close-gate" data-checkpoint="entry1" style="display: none;">
                                <i class="fas fa-lock"></i>
                                Đóng
                            </button>
                        </div>
                    </div>
                    <div class="gate-status" data-gate="entry1" style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; border-left: 3px solid #e74c3c;">
                        <div style="font-size: 12px; color: #e74c3c;">
                            <i class="fas fa-times-circle"></i>
                            Đóng
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 500;">Chốt vào 2</div>
                            <div style="font-size: 12px; color: var(--light-gray);">Cổng phụ</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn-primary-admin btn-sm btn-open-gate" data-checkpoint="entry2" data-status="closed">
                                <i class="fas fa-unlock"></i>
                                Mở
                            </button>
                            <button class="btn-danger-admin btn-sm btn-close-gate" data-checkpoint="entry2" style="display: none;">
                                <i class="fas fa-lock"></i>
                                Đóng
                            </button>
                        </div>
                    </div>
                    <div class="gate-status" data-gate="entry2" style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; border-left: 3px solid #e74c3c;">
                        <div style="font-size: 12px; color: #e74c3c;">
                            <i class="fas fa-times-circle"></i>
                            Đóng
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 500;">Chốt ra 1</div>
                            <div style="font-size: 12px; color: var(--light-gray);">Cổng chính</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn-primary-admin btn-sm btn-open-gate" data-checkpoint="exit1" data-status="closed">
                                <i class="fas fa-unlock"></i>
                                Mở
                            </button>
                            <button class="btn-danger-admin btn-sm btn-close-gate" data-checkpoint="exit1" style="display: none;">
                                <i class="fas fa-lock"></i>
                                Đóng
                            </button>
                        </div>
                    </div>
                    <div class="gate-status" data-gate="exit1" style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; border-left: 3px solid #e74c3c;">
                        <div style="font-size: 12px; color: #e74c3c;">
                            <i class="fas fa-times-circle"></i>
                            Đóng
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 500;">Chốt ra 2</div>
                            <div style="font-size: 12px; color: var(--light-gray);">Cổng phụ</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn-primary-admin btn-sm btn-open-gate" data-checkpoint="exit2" data-status="closed">
                                <i class="fas fa-unlock"></i>
                                Mở
                            </button>
                            <button class="btn-danger-admin btn-sm btn-close-gate" data-checkpoint="exit2" style="display: none;">
                                <i class="fas fa-lock"></i>
                                Đóng
                            </button>
                        </div>
                    </div>
                    <div class="gate-status" data-gate="exit2" style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; border-left: 3px solid #e74c3c;">
                        <div style="font-size: 12px; color: #e74c3c;">
                            <i class="fas fa-times-circle"></i>
                            Đóng
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Thông báo cảnh báo</h3>
            </div>
            <div>
                <div style="padding: 12px; background: rgba(255, 152, 0, 0.1); border-radius: 6px; border-left: 3px solid #ff9800; margin-bottom: 10px;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <i class="fas fa-exclamation-triangle" style="color: #ff9800; margin-top: 2px;"></i>
                        <div>
                            <div style="font-size: 13px; font-weight: 500; color: #ff9800;">Khu B gần đầy</div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Chỉ còn 8 chỗ trống</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 12px; background: rgba(33, 166, 145, 0.1); border-radius: 6px; border-left: 3px solid #21A691; margin-bottom: 10px;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <i class="fas fa-info-circle" style="color: #21A691; margin-top: 2px;"></i>
                        <div>
                            <div style="font-size: 13px; font-weight: 500; color: #21A691;">Giờ cao điểm</div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Lưu lượng xe tăng cao</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Chọn Bãi Đỗ Toàn Màn Hình -->
<div class="modal fade" id="fullscreenModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chọn khu đỗ xe để xem</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="parking-zone-selection">
                    <div class="zone-card" data-zone="A">
                        <div class="zone-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-motorcycle" style="font-size: 32px;"></i>
                        </div>
                        <h4>Khu A - Xe máy</h4>
                        <p>60 chỗ đỗ</p>
                        <div class="zone-status">
                            <span class="occupied-count">42 đã đỗ</span>
                            <span class="available-count">18 trống</span>
                        </div>
                        <button class="btn-primary-admin mt-2 btn-select-zone" data-zone="A">
                            <i class="fas fa-eye"></i> Xem chi tiết
                        </button>
                    </div>
                    <div class="zone-card" data-zone="B">
                        <div class="zone-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-car" style="font-size: 32px;"></i>
                        </div>
                        <h4>Khu B - Ô tô</h4>
                        <p>40 chỗ đỗ</p>
                        <div class="zone-status">
                            <span class="occupied-count">28 đã đỗ</span>
                            <span class="available-count">12 trống</span>
                        </div>
                        <button class="btn-primary-admin mt-2 btn-select-zone" data-zone="B">
                            <i class="fas fa-eye"></i> Xem chi tiết
                        </button>
                    </div>
                    <div class="zone-card" data-zone="C">
                        <div class="zone-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <i class="fas fa-truck" style="font-size: 32px;"></i>
                        </div>
                        <h4>Khu C - Xe tải</h4>
                        <p>20 chỗ đỗ</p>
                        <div class="zone-status">
                            <span class="occupied-count">14 đã đỗ</span>
                            <span class="available-count">6 trống</span>
                        </div>
                        <button class="btn-primary-admin mt-2 btn-select-zone" data-zone="C">
                            <i class="fas fa-eye"></i> Xem chi tiết
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Xem Map Toàn Màn Hình -->
<div class="modal fade" id="fullscreenMapModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title" id="fullscreenMapTitle">Khu A - Xe máy</h5>
                    <small class="text-muted" id="fullscreenMapSubtitle">60 chỗ đỗ</small>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn-secondary-admin btn-sm" id="btnBackToSelection">
                        <i class="fas fa-arrow-left"></i> Chọn khu khác
                    </button>
                    <button type="button" class="btn-secondary-admin btn-sm" id="btnZoomInFull">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button type="button" class="btn-secondary-admin btn-sm" id="btnZoomOutFull">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-body" style="background: #f8f9fa; padding: 30px;">
                <div id="fullscreenMapContent" style="max-width: 1400px; margin: 0 auto;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Chi tiết chỗ đỗ -->
<div class="modal fade" id="spotDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chi tiết chỗ đỗ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="spotDetailContent">
                <!-- Content will be dynamically loaded -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary-admin" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Cài đặt -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cài đặt giám sát</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tự động làm mới</label>
                    <select class="form-select" id="autoRefreshInterval">
                        <option value="5000" selected>5 giây</option>
                        <option value="10000">10 giây</option>
                        <option value="30000">30 giây</option>
                        <option value="60000">1 phút</option>
                        <option value="0">Tắt</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Hiển thị cảnh báo</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="showWarnings" checked>
                        <label class="form-check-label" for="showWarnings">
                            Bật thông báo cảnh báo
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Âm thanh thông báo</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="soundNotification">
                        <label class="form-check-label" for="soundNotification">
                            Bật âm thanh khi có xe vào/ra
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary-admin" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn-primary-admin" id="btnSaveSettings">Lưu cài đặt</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Map ảo tổng quan -->
<div class="modal fade" id="virtualMapModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-map-marked-alt me-2"></i>
                    Map ảo - Tổng quan bãi đỗ xe
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; overflow: auto;">
                <div class="virtual-map-container">
                    <!-- Top Gates -->
                    <div class="virtual-gates-row">
                        <div class="virtual-gate entry" data-gate="entry1">
                            <div class="gate-indicator closed">
                                <i class="fas fa-traffic-light"></i>
                            </div>
                            <div class="gate-label">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Chốt vào 1</span>
                            </div>
                            <div class="gate-traffic">12 xe/h</div>
                        </div>
                        <div class="virtual-spacer"></div>
                        <div class="virtual-gate entry" data-gate="entry2">
                            <div class="gate-indicator closed">
                                <i class="fas fa-traffic-light"></i>
                            </div>
                            <div class="gate-label">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Chốt vào 2</span>
                            </div>
                            <div class="gate-traffic">8 xe/h</div>
                        </div>
                    </div>

                    <!-- Main Parking Area -->
                    <div class="virtual-parking-area">
                        <!-- Zone A -->
                        <div class="virtual-zone zone-a">
                            <div class="zone-header">
                                <i class="fas fa-motorcycle"></i>
                                <span>KHU A</span>
                            </div>
                            <div class="zone-info">Xe máy - 60 chỗ</div>
                            <div class="zone-stats">
                                <div class="stat occupied">
                                    <i class="fas fa-car"></i>
                                    <span id="zoneA-occupied">42</span>
                                </div>
                                <div class="stat available">
                                    <i class="fas fa-parking"></i>
                                    <span id="zoneA-available">18</span>
                                </div>
                            </div>
                            <div class="zone-mini-grid motorcycle" id="zoneA-grid"></div>
                        </div>

                        <!-- Zone B -->
                        <div class="virtual-zone zone-b">
                            <div class="zone-header">
                                <i class="fas fa-car"></i>
                                <span>KHU B</span>
                            </div>
                            <div class="zone-info">Ô tô - 40 chỗ</div>
                            <div class="zone-stats">
                                <div class="stat occupied">
                                    <i class="fas fa-car"></i>
                                    <span id="zoneB-occupied">28</span>
                                </div>
                                <div class="stat available">
                                    <i class="fas fa-parking"></i>
                                    <span id="zoneB-available">12</span>
                                </div>
                            </div>
                            <div class="zone-mini-grid car" id="zoneB-grid"></div>
                        </div>

                        <!-- Zone C -->
                        <div class="virtual-zone zone-c">
                            <div class="zone-header">
                                <i class="fas fa-truck"></i>
                                <span>KHU C</span>
                            </div>
                            <div class="zone-info">Xe tải - 20 chỗ</div>
                            <div class="zone-stats">
                                <div class="stat occupied">
                                    <i class="fas fa-car"></i>
                                    <span id="zoneC-occupied">14</span>
                                </div>
                                <div class="stat available">
                                    <i class="fas fa-parking"></i>
                                    <span id="zoneC-available">6</span>
                                </div>
                            </div>
                            <div class="zone-mini-grid truck" id="zoneC-grid"></div>
                        </div>
                    </div>

                    <!-- Bottom Gates -->
                    <div class="virtual-gates-row">
                        <div class="virtual-gate exit" data-gate="exit1">
                            <div class="gate-indicator closed">
                                <i class="fas fa-traffic-light"></i>
                            </div>
                            <div class="gate-label">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Chốt ra 1</span>
                            </div>
                            <div class="gate-traffic">10 xe/h</div>
                        </div>
                        <div class="virtual-spacer"></div>
                        <div class="virtual-gate exit" data-gate="exit2">
                            <div class="gate-indicator closed">
                                <i class="fas fa-traffic-light"></i>
                            </div>
                            <div class="gate-label">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Chốt ra 2</span>
                            </div>
                            <div class="gate-traffic">9 xe/h</div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="virtual-legend">
                        <div class="legend-item">
                            <div class="legend-box occupied"></div>
                            <span>Đã đỗ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box available"></div>
                            <span>Trống</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle open"></div>
                            <span>Chốt mở</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle closed"></div>
                            <span>Chốt đóng</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .parking-spot {
        aspect-ratio: 1;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .parking-spot.occupied {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    .parking-spot.available {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    .parking-spot.maintenance {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
    }

    .parking-spot.car {
        font-size: 12px;
    }

    .parking-spot.truck {
        font-size: 12px;
    }

    .parking-spot:hover {
        transform: scale(1.1);
        border-color: #21A691;
        box-shadow: 0 4px 12px rgba(33, 166, 145, 0.3);
        z-index: 10;
    }

    .activity-item {
        display: flex;
        align-items: center;
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s;
    }

    .activity-item:hover {
        background: #f8f9fa;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    @@keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
    }

    .parking-zone-selection {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 10px;
    }

    .zone-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .zone-card:hover {
        border-color: #21A691;
        box-shadow: 0 4px 16px rgba(33, 166, 145, 0.2);
        transform: translateY(-5px);
    }

    .zone-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        color: white;
    }

    .zone-card h4 {
        margin-bottom: 8px;
        color: #333;
        font-size: 18px;
    }

    .zone-card p {
        color: #666;
        margin-bottom: 12px;
        font-size: 14px;
    }

    .zone-status {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 12px;
        font-size: 13px;
    }

    .occupied-count {
        color: #e74c3c;
        font-weight: 500;
    }

    .available-count {
        color: #27ae60;
        font-weight: 500;
    }

    #fullscreenMapContent {
        transform-origin: center;
        transition: transform 0.3s ease;
    }

    .spot-detail-info {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .spot-detail-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
    }

    .spot-detail-row:last-child {
        border-bottom: none;
    }

    .spot-detail-label {
        font-weight: 500;
        color: #666;
    }

    .spot-detail-value {
        color: #333;
        font-weight: 600;
    }

    .btn-danger-admin {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-danger-admin:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }

    .virtual-map-container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .virtual-gates-row {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 30px 0;
        gap: 20px;
    }

    .virtual-gate {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        text-align: center;
        min-width: 200px;
        transition: all 0.3s ease;
        position: relative;
    }

    .virtual-gate:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
    }

    .virtual-gate.entry {
        border-top: 4px solid #667eea;
    }

    .virtual-gate.exit {
        border-bottom: 4px solid #4facfe;
    }

    .gate-indicator {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        animation: pulse-gate 2s infinite;
    }

    .gate-indicator.open {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
    }

    .gate-indicator.closed {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
    }

    .gate-label {
        font-weight: bold;
        font-size: 16px;
        color: #333;
        margin-bottom: 10px;
    }

    .gate-label i {
        margin-right: 8px;
        color: #667eea;
    }

    .gate-traffic {
        font-size: 24px;
        font-weight: bold;
        color: #21A691;
    }

    .virtual-spacer {
        flex: 1;
        height: 2px;
        background: linear-gradient(90deg, transparent, #ddd, transparent);
    }

    .virtual-parking-area {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        margin: 40px 0;
    }

    .virtual-zone {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .virtual-zone:hover {
        transform: scale(1.05);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    }

    .zone-a {
        border-top: 5px solid #667eea;
    }

    .zone-b {
        border-top: 5px solid #4facfe;
    }

    .zone-c {
        border-top: 5px solid #fa709a;
    }

    .zone-header {
        font-size: 22px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .zone-header i {
        font-size: 28px;
        color: #667eea;
    }

    .zone-b .zone-header i {
        color: #4facfe;
    }

    .zone-c .zone-header i {
        color: #fa709a;
    }

    .zone-info {
        font-size: 14px;
        color: #666;
        margin-bottom: 15px;
    }

    .zone-stats {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }

    .zone-stats .stat {
        text-align: center;
    }

    .zone-stats .stat i {
        display: block;
        font-size: 24px;
        margin-bottom: 8px;
    }

    .zone-stats .stat.occupied i {
        color: #e74c3c;
    }

    .zone-stats .stat.available i {
        color: #27ae60;
    }

    .zone-stats .stat span {
        font-size: 28px;
        font-weight: bold;
    }

    .zone-mini-grid {
        display: grid;
        gap: 4px;
        margin-top: 15px;
        padding: 15px;
        background: white;
        border-radius: 10px;
    }

    .zone-mini-grid.motorcycle {
        grid-template-columns: repeat(12, 1fr);
    }

    .zone-mini-grid.car {
        grid-template-columns: repeat(10, 1fr);
    }

    .zone-mini-grid.truck {
        grid-template-columns: repeat(10, 1fr);
    }

    .mini-spot {
        aspect-ratio: 1;
        border-radius: 3px;
        transition: all 0.2s ease;
    }

    .mini-spot.occupied {
        background: #e74c3c;
    }

    .mini-spot.available {
        background: #27ae60;
    }

    .mini-spot:hover {
        transform: scale(1.2);
    }

    .virtual-legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        font-weight: 500;
    }

    .legend-box,
    .legend-circle {
        width: 24px;
        height: 24px;
        border-radius: 4px;
    }

    .legend-circle {
        border-radius: 50%;
    }

    .legend-box.occupied,
    .legend-circle.closed {
        background: #e74c3c;
    }

    .legend-box.available,
    .legend-circle.open {
        background: #27ae60;
    }

    @@keyframes pulse-gate {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }
</style>

<script>
    let zoomLevel = 1;
    let autoRefreshTimer = null;
    let autoRefreshInterval = 5000;

    // Parking data structure
    const parkingData = {
        A: {
            name: 'Khu A - Xe máy',
            total: 60,
            grid: { rows: 5, cols: 12 },
            type: 'motorcycle',
            spots: generateSpots('A', 60)
        },
        B: {
            name: 'Khu B - Ô tô',
            total: 40,
            grid: { rows: 4, cols: 10 },
            type: 'car',
            spots: generateSpots('B', 40)
        },
        C: {
            name: 'Khu C - Xe tải',
            total: 20,
            grid: { rows: 2, cols: 10 },
            type: 'truck',
            spots: generateSpots('C', 20)
        }
    };

    function generateSpots(zone, count) {
        const spots = [];
        for (let i = 1; i <= count; i++) {
            const isOccupied = Math.random() > 0.4;
            spots.push({
                id: `${zone}${String(i).padStart(2, '0')}`,
                number: i,
                status: isOccupied ? 'occupied' : 'available',
                vehicle: isOccupied ? {
                    plate: generatePlate(),
                    entryTime: new Date(Date.now() - Math.random() * 8 * 60 * 60 * 1000),
                    type: zone === 'A' ? 'Xe máy' : zone === 'B' ? 'Ô tô' : 'Xe tải'
                } : null
            });
        }
        return spots;
    }

    function generatePlate() {
        const provinces = ['59A1', '30A', '29B1', '51G', '30E'];
        const num = Math.floor(Math.random() * 90000) + 10000;
        return `${provinces[Math.floor(Math.random() * provinces.length)]}-${num}`;
    }

    // Button: Làm mới
    document.getElementById('btnRefresh').addEventListener('click', function() {
        const icon = this.querySelector('i');
        icon.classList.add('fa-spin');
        
        // Simulate refresh
        setTimeout(() => {
            icon.classList.remove('fa-spin');
            showNotification('Dữ liệu đã được cập nhật!', 'success');
            refreshParkingData();
        }, 1000);
    });

    // Button: Xem map ảo
    document.getElementById('btnVirtualMap').addEventListener('click', function() {
        showVirtualMap();
    });

    // Button: Cài đặt
    document.getElementById('btnSettings').addEventListener('click', function() {
        const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
        modal.show();
    });

    // Button: Lưu cài đặt
    document.getElementById('btnSaveSettings').addEventListener('click', function() {
        autoRefreshInterval = parseInt(document.getElementById('autoRefreshInterval').value);
        const showWarnings = document.getElementById('showWarnings').checked;
        const soundNotification = document.getElementById('soundNotification').checked;
        
        // Restart auto refresh timer
        if (autoRefreshTimer) {
            clearInterval(autoRefreshTimer);
        }
        
        if (autoRefreshInterval > 0) {
            autoRefreshTimer = setInterval(refreshParkingData, autoRefreshInterval);
        }
        
        bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
        showNotification('Cài đặt đã được lưu!', 'success');
    });

    // Button: Zoom In
    document.getElementById('btnZoomIn').addEventListener('click', function() {
        if (zoomLevel < 1.5) {
            zoomLevel += 0.1;
            document.getElementById('parkingMapContainer').style.transform = `scale(${zoomLevel})`;
        }
    });

    // Button: Zoom Out
    document.getElementById('btnZoomOut').addEventListener('click', function() {
        if (zoomLevel > 0.7) {
            zoomLevel -= 0.1;
            document.getElementById('parkingMapContainer').style.transform = `scale(${zoomLevel})`;
        }
    });

    // Button: Toàn màn hình - Show zone selection
    document.getElementById('btnFullscreen').addEventListener('click', function() {
        const modal = new bootstrap.Modal(document.getElementById('fullscreenModal'));
        modal.show();
    });

    // Zone selection buttons
    document.querySelectorAll('.btn-select-zone').forEach(btn => {
        btn.addEventListener('click', function() {
            const zone = this.getAttribute('data-zone');
            showFullscreenMap(zone);
        });
    });

    // Back to zone selection
    document.getElementById('btnBackToSelection').addEventListener('click', function() {
        bootstrap.Modal.getInstance(document.getElementById('fullscreenMapModal')).hide();
        const modal = new bootstrap.Modal(document.getElementById('fullscreenModal'));
        modal.show();
    });

    // Fullscreen zoom controls
    let fullscreenZoom = 1;
    document.getElementById('btnZoomInFull').addEventListener('click', function() {
        if (fullscreenZoom < 2) {
            fullscreenZoom += 0.2;
            document.getElementById('fullscreenMapContent').style.transform = `scale(${fullscreenZoom})`;
        }
    });

    document.getElementById('btnZoomOutFull').addEventListener('click', function() {
        if (fullscreenZoom > 0.6) {
            fullscreenZoom -= 0.2;
            document.getElementById('fullscreenMapContent').style.transform = `scale(${fullscreenZoom})`;
        }
    });

    // Show fullscreen map for selected zone
    function showFullscreenMap(zone) {
        const data = parkingData[zone];
        document.getElementById('fullscreenMapTitle').textContent = data.name;
        document.getElementById('fullscreenMapSubtitle').textContent = `${data.total} chỗ đỗ`;
        
        const content = document.getElementById('fullscreenMapContent');
        content.innerHTML = generateParkingGrid(zone, data, true);
        
        bootstrap.Modal.getInstance(document.getElementById('fullscreenModal')).hide();
        const modal = new bootstrap.Modal(document.getElementById('fullscreenMapModal'));
        modal.show();
        
        fullscreenZoom = 1;
        content.style.transform = 'scale(1)';
        
        // Re-attach click handlers
        attachParkingSpotHandlers();
    }

    // Generate parking grid HTML
    function generateParkingGrid(zone, data, isFullscreen = false) {
        const gapSize = isFullscreen ? '15px' : '8px';
        const gridCols = data.grid.cols;
        const spotClass = data.type === 'motorcycle' ? '' : data.type;
        
        let html = `
            <div style="background: white; padding: ${isFullscreen ? '40px' : '20px'}; border-radius: 12px; border: 2px solid #21A691;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 25px;">
                    <div style="font-weight: bold; color: #333; font-size: ${isFullscreen ? '24px' : '16px'};">${data.name}</div>
                    <div style="font-size: ${isFullscreen ? '18px' : '13px'}; color: #666;">${data.total} chỗ</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(${gridCols}, 1fr); gap: ${gapSize}; margin-bottom: 25px;">
        `;
        
        data.spots.forEach(spot => {
            html += `
                <div class="parking-spot ${spotClass} ${spot.status}" 
                     title="${spot.id} - ${spot.status === 'occupied' ? 'Đã đỗ' : 'Trống'}"
                     data-spot-id="${spot.id}"
                     data-zone="${zone}">
                    ${spot.number}
                </div>
            `;
        });
        
        html += `
                </div>
                <div style="display: flex; gap: 30px; padding-top: 20px; border-top: 2px solid #ddd; justify-content: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: ${isFullscreen ? '32px' : '24px'}; height: ${isFullscreen ? '32px' : '24px'}; background: #e74c3c; border-radius: 4px;"></div>
                        <span style="font-size: ${isFullscreen ? '16px' : '13px'}; font-weight: 500;">Đã đỗ</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: ${isFullscreen ? '32px' : '24px'}; height: ${isFullscreen ? '32px' : '24px'}; background: #27ae60; border-radius: 4px;"></div>
                        <span style="font-size: ${isFullscreen ? '16px' : '13px'}; font-weight: 500;">Trống</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: ${isFullscreen ? '32px' : '24px'}; height: ${isFullscreen ? '32px' : '24px'}; background: #95a5a6; border-radius: 4px;"></div>
                        <span style="font-size: ${isFullscreen ? '16px' : '13px'}; font-weight: 500;">Bảo trì</span>
                    </div>
                </div>
            </div>
        `;
        
        return html;
    }

    // Attach click handlers to parking spots
    function attachParkingSpotHandlers() {
        document.querySelectorAll('.parking-spot').forEach(spot => {
            spot.addEventListener('click', function() {
                const spotId = this.getAttribute('data-spot-id');
                const zone = this.getAttribute('data-zone');
                showSpotDetail(zone, spotId);
            });
        });
    }

    // Show spot detail modal
    function showSpotDetail(zone, spotId) {
        const data = parkingData[zone];
        const spot = data.spots.find(s => s.id === spotId);
        
        if (!spot) return;
        
        let html = `
            <div class="spot-detail-info">
                <h5 style="margin-bottom: 15px; color: #21A691;">
                    <i class="fas fa-parking"></i> ${spot.id}
                </h5>
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Khu vực:</span>
                    <span class="spot-detail-value">${data.name}</span>
                </div>
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Trạng thái:</span>
                    <span class="spot-detail-value">
                        ${spot.status === 'occupied' 
                            ? '<span class="status-badge danger">Đã đỗ</span>' 
                            : '<span class="status-badge success">Trống</span>'}
                    </span>
                </div>
        `;
        
        if (spot.vehicle) {
            const duration = Math.floor((Date.now() - spot.vehicle.entryTime) / (1000 * 60));
            const hours = Math.floor(duration / 60);
            const minutes = duration % 60;
            
            html += `
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Biển số:</span>
                    <span class="spot-detail-value">${spot.vehicle.plate}</span>
                </div>
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Loại xe:</span>
                    <span class="spot-detail-value">${spot.vehicle.type}</span>
                </div>
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Thời gian vào:</span>
                    <span class="spot-detail-value">${formatDateTime(spot.vehicle.entryTime)}</span>
                </div>
                <div class="spot-detail-row">
                    <span class="spot-detail-label">Thời gian gửi:</span>
                    <span class="spot-detail-value">${hours}h ${minutes}p</span>
                </div>
            `;
        }
        
        html += `
            </div>
            ${spot.vehicle ? `
                <div class="d-grid gap-2">
                    <button class="btn-primary-admin" onclick="checkoutVehicle('${spot.id}')">
                        <i class="fas fa-sign-out-alt"></i> Xe ra bãi
                    </button>
                </div>
            ` : ''}
        `;
        
        document.getElementById('spotDetailContent').innerHTML = html;
        const modal = new bootstrap.Modal(document.getElementById('spotDetailModal'));
        modal.show();
    }

    // Checkout vehicle
    function checkoutVehicle(spotId) {
        if (confirm('Xác nhận xe ra bãi?')) {
            // Find and update spot
            for (const zone in parkingData) {
                const spot = parkingData[zone].spots.find(s => s.id === spotId);
                if (spot) {
                    spot.status = 'available';
                    spot.vehicle = null;
                    break;
                }
            }
            
            bootstrap.Modal.getInstance(document.getElementById('spotDetailModal')).hide();
            showNotification('Xe đã ra bãi thành công!', 'success');
            refreshParkingData();
        }
    }

    // Gate control buttons
    const gateStates = {
        entry1: 'closed',
        entry2: 'closed',
        exit1: 'closed',
        exit2: 'closed'
    };

    // Button: Open Gate
    document.querySelectorAll('.btn-open-gate').forEach(btn => {
        btn.addEventListener('click', function() {
            const checkpoint = this.getAttribute('data-checkpoint');
            const checkpointName = this.closest('div[style*="margin-bottom"]').querySelector('div[style*="font-weight: 500"]').textContent;
            
            if (confirm(`Xác nhận mở ${checkpointName}?`)) {
                const icon = this.querySelector('i');
                icon.classList.remove('fa-unlock');
                icon.classList.add('fa-spinner', 'fa-spin');
                
                // Simulate gate opening
                setTimeout(() => {
                    icon.classList.remove('fa-spinner', 'fa-spin');
                    icon.classList.add('fa-unlock');
                    
                    // Update gate state
                    gateStates[checkpoint] = 'open';
                    updateGateStatus(checkpoint, 'open');
                    
                    // Toggle buttons
                    this.style.display = 'none';
                    this.nextElementSibling.style.display = 'inline-block';
                    
                    showNotification(`${checkpointName} đã được mở!`, 'success');
                    updateVirtualMapGates();
                }, 1500);
            }
        });
    });

    // Button: Close Gate
    document.querySelectorAll('.btn-close-gate').forEach(btn => {
        btn.addEventListener('click', function() {
            const checkpoint = this.getAttribute('data-checkpoint');
            const checkpointName = this.closest('div[style*="margin-bottom"]').querySelector('div[style*="font-weight: 500"]').textContent;
            
            if (confirm(`Xác nhận đóng ${checkpointName}?`)) {
                const icon = this.querySelector('i');
                icon.classList.remove('fa-lock');
                icon.classList.add('fa-spinner', 'fa-spin');
                
                // Simulate gate closing
                setTimeout(() => {
                    icon.classList.remove('fa-spinner', 'fa-spin');
                    icon.classList.add('fa-lock');
                    
                    // Update gate state
                    gateStates[checkpoint] = 'closed';
                    updateGateStatus(checkpoint, 'closed');
                    
                    // Toggle buttons
                    this.style.display = 'none';
                    this.previousElementSibling.style.display = 'inline-block';
                    
                    showNotification(`${checkpointName} đã được đóng!`, 'error');
                    updateVirtualMapGates();
                }, 1500);
            }
        });
    });

    // Update gate status display
    function updateGateStatus(checkpoint, status) {
        const statusDiv = document.querySelector(`.gate-status[data-gate="${checkpoint}"]`);
        if (!statusDiv) return;
        
        if (status === 'open') {
            statusDiv.style.background = 'rgba(39, 174, 96, 0.1)';
            statusDiv.style.borderLeftColor = '#27ae60';
            statusDiv.innerHTML = `
                <div style="font-size: 12px; color: #27ae60;">
                    <i class="fas fa-check-circle"></i>
                    Đang mở
                </div>
            `;
        } else {
            statusDiv.style.background = 'rgba(231, 76, 60, 0.1)';
            statusDiv.style.borderLeftColor = '#e74c3c';
            statusDiv.innerHTML = `
                <div style="font-size: 12px; color: #e74c3c;">
                    <i class="fas fa-times-circle"></i>
                    Đóng
                </div>
            `;
        }
        
        // Update stat card
        updateGateStatCard();
    }

    // Update gate stat card
    function updateGateStatCard() {
        const activeCount = Object.values(gateStates).filter(state => state === 'open').length;
        const totalGates = Object.keys(gateStates).length;
        
        // Update count
        document.getElementById('activeGatesCount').textContent = `${activeCount}/${totalGates}`;
        
        // Update status and trend
        const trendDiv = document.getElementById('activeGatesTrend');
        const statusSpan = document.getElementById('activeGatesStatus');
        
        if (activeCount === 0) {
            trendDiv.className = 'stat-card-trend down';
            trendDiv.querySelector('i').className = 'fas fa-times-circle';
            statusSpan.textContent = 'Tất cả đóng';
        } else if (activeCount === totalGates) {
            trendDiv.className = 'stat-card-trend up';
            trendDiv.querySelector('i').className = 'fas fa-check-circle';
            statusSpan.textContent = 'Tất cả hoạt động';
        } else {
            trendDiv.className = 'stat-card-trend';
            trendDiv.querySelector('i').className = 'fas fa-circle';
            statusSpan.textContent = `${activeCount} đang mở`;
        }
    }

    // Show virtual map
    function showVirtualMap() {
        // Generate mini grids for each zone
        generateMiniGrid('A', 'zoneA-grid', parkingData.A);
        generateMiniGrid('B', 'zoneB-grid', parkingData.B);
        generateMiniGrid('C', 'zoneC-grid', parkingData.C);
        
        // Update zone statistics
        updateZoneStats();
        
        // Update gate indicators
        updateVirtualMapGates();
        
        const modal = new bootstrap.Modal(document.getElementById('virtualMapModal'));
        modal.show();
    }

    // Generate mini grid for zone
    function generateMiniGrid(zone, containerId, data) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        data.spots.forEach(spot => {
            const miniSpot = document.createElement('div');
            miniSpot.className = `mini-spot ${spot.status}`;
            miniSpot.title = `${spot.id} - ${spot.status === 'occupied' ? 'Đã đỗ' : 'Trống'}`;
            container.appendChild(miniSpot);
        });
    }

    // Update zone statistics
    function updateZoneStats() {
        for (const zone in parkingData) {
            const occupied = parkingData[zone].spots.filter(s => s.status === 'occupied').length;
            const available = parkingData[zone].spots.filter(s => s.status === 'available').length;
            
            const occupiedEl = document.getElementById(`zone${zone}-occupied`);
            const availableEl = document.getElementById(`zone${zone}-available`);
            
            if (occupiedEl) occupiedEl.textContent = occupied;
            if (availableEl) availableEl.textContent = available;
        }
    }

    // Update virtual map gate indicators
    function updateVirtualMapGates() {
        for (const gate in gateStates) {
            const indicator = document.querySelector(`.virtual-gate[data-gate="${gate}"] .gate-indicator`);
            if (indicator) {
                indicator.classList.remove('open', 'closed');
                indicator.classList.add(gateStates[gate]);
            }
        }
    }

    // Gate control buttons (legacy code removed, replaced with new above)

    // Helper functions
    function formatDateTime(date) {
        const d = new Date(date);
        return `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getFullYear()} ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
    }

    function showNotification(message, type) {
        // Simple notification - can be replaced with toast library
        const colors = {
            success: '#27ae60',
            error: '#e74c3c',
            info: '#21A691'
        };
        
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${colors[type] || colors.info};
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideIn 0.3s ease;
        `;
        notification.innerHTML = `<i class="fas fa-check-circle me-2"></i>${message}`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    function refreshParkingData() {
        // Simulate data refresh
        console.log('Refreshing parking data...');
        // In production, this would fetch from API
        // For now, randomly update some spots
        for (const zone in parkingData) {
            parkingData[zone].spots.forEach(spot => {
                if (Math.random() > 0.95) {
                    spot.status = spot.status === 'occupied' ? 'available' : 'occupied';
                    if (spot.status === 'occupied') {
                        spot.vehicle = {
                            plate: generatePlate(),
                            entryTime: new Date(),
                            type: zone === 'A' ? 'Xe máy' : zone === 'B' ? 'Ô tô' : 'Xe tải'
                        };
                    } else {
                        spot.vehicle = null;
                    }
                }
            });
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Attach handlers to existing parking spots
        attachParkingSpotHandlers();
        
        // Initialize gate stat card
        updateGateStatCard();
        
        // Start auto refresh
        if (autoRefreshInterval > 0) {
            autoRefreshTimer = setInterval(refreshParkingData, autoRefreshInterval);
        }
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @@keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @@keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
</script>
