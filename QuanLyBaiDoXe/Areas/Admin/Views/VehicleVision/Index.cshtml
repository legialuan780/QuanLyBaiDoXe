@{
    ViewData["Title"] = "Giám sát bãi đỗ xe";
}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">Giám sát bãi đỗ xe</h1>
        <div class="breadcrumb">
            <a href="@Url.Action("Index", "Dashboard", new { area = "Admin" })">Trang chủ</a>
            <span>/</span>
            <span>Giám sát bãi</span>
        </div>
    </div>
    <div>
        <button class="btn-secondary-admin" onclick="openAllCameras()">
            <i class="fas fa-video"></i>
            Camera
        </button>
        <button class="btn-secondary-admin" onclick="showOverviewMap()">
            <i class="fas fa-map-marked-alt"></i>
            Map tổng quan
        </button>
        <button class="btn-secondary-admin" onclick="refreshParkingLot()">
            <i class="fas fa-sync-alt"></i>
            Làm mới
        </button>
        <button class="btn-primary-admin" id="fullscreenBtn" onclick="toggleFullscreenMode()">
            <i class="fas fa-expand-arrows-alt" id="fullscreenIcon"></i>
            <span id="fullscreenText">Toàn màn hình</span>
        </button>
    </div>
</div>

<!-- Stat Cards -->
<div class="stat-cards">
    <div class="stat-card">
        <div class="stat-card-icon teal">
            <i class="fas fa-parking"></i>
        </div>
        <div class="stat-card-info">
            <h3 id="totalSlots">80</h3>
            <p>Tổng chỗ đỗ</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon green">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-card-info">
            <h3 id="availableSlots">38</h3>
            <p>Chỗ trống</p>
        </div>
        <div class="stat-card-trend up">
            <i class="fas fa-arrow-up"></i>
            47.5%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon orange">
            <i class="fas fa-car"></i>
        </div>
        <div class="stat-card-info">
            <h3 id="occupiedSlots">39</h3>
            <p>Đang sử dụng</p>
        </div>
        <div class="stat-card-trend">
            <i class="fas fa-minus"></i>
            48.7%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon red">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-card-info">
            <h3 id="reservedSlots">3</h3>
            <p>Đã đặt / Bảo trì</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- Parking Lot Map -->
    <div class="col-lg-8">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Sơ đồ bãi đỗ xe</h3>
                <div>
                    <button class="btn-secondary-admin btn-sm" id="viewModeToggle" onclick="toggleViewMode()">
                        <i class="fas fa-compress-alt" id="viewModeIcon"></i>
                        <span id="viewModeText">Chế độ rút gọn</span>
                    </button>
                </div>
            </div>
            <div class="parking-map-container">
                <!-- Legend -->
                <div class="parking-legend mb-3">
                    <div class="legend-item">
                        <span class="legend-color available"></span>
                        <span>Trống</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color occupied"></span>
                        <span>Đang đỗ</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color reserved"></span>
                        <span>Đã đặt</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color maintenance"></span>
                        <span>Bảo trì</span>
                    </div>
                </div>

                <!-- Compact View Mode -->
                <div id="compactView" class="compact-view" style="display: none;">
                    <div class="compact-sections">
                        <!-- Section A - Xe máy -->
                        <div class="compact-section" id="section-a" onclick="toggleCompactSection('section-a', event)">
                            <div class="compact-section-header">
                                <div class="compact-section-icon motorcycle-icon">
                                    <i class="fas fa-motorcycle"></i>
                                </div>
                                <div class="compact-section-info">
                                    <h4 class="compact-section-title">Khu A - Xe máy</h4>
                                    <div class="compact-section-stats">
                                        <span class="stat-badge available-badge">15 trống</span>
                                        <span class="stat-badge occupied-badge">24 đỗ</span>
                                        <span class="stat-badge reserved-badge">1 đặt</span>
                                    </div>
                                </div>
                                <div class="compact-section-summary">
                                    <div class="summary-percentage">60%</div>
                                    <div class="summary-total">40 chỗ</div>
                                </div>
                                <button class="compact-expand-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="compact-progress-bar">
                                <div class="compact-progress-fill occupied-fill" style="width: 60%"></div>
                                <div class="compact-progress-fill reserved-fill" style="width: 2.5%"></div>
                            </div>
                            
                            <!-- Expanded Content -->
                            <div class="compact-section-expanded" style="display: none;">
                                <div class="expanded-grid motorcycle-grid">
                                    <div class="parking-slot motorcycle available" data-slot="A01" onclick="viewSlotDetails('A01'); event.stopPropagation();">
                                        <span class="slot-number">A01</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A02" onclick="viewSlotDetails('A02'); event.stopPropagation();">
                                        <span class="slot-number">A02</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A03" onclick="viewSlotDetails('A03'); event.stopPropagation();">
                                        <span class="slot-number">A03</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A04" onclick="viewSlotDetails('A04'); event.stopPropagation();">
                                        <span class="slot-number">A04</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A05" onclick="viewSlotDetails('A05'); event.stopPropagation();">
                                        <span class="slot-number">A05</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A06" onclick="viewSlotDetails('A06'); event.stopPropagation();">
                                        <span class="slot-number">A06</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A07" onclick="viewSlotDetails('A07'); event.stopPropagation();">
                                        <span class="slot-number">A07</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A08" onclick="viewSlotDetails('A08'); event.stopPropagation();">
                                        <span class="slot-number">A08</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A09" onclick="viewSlotDetails('A09'); event.stopPropagation();">
                                        <span class="slot-number">A09</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A10" onclick="viewSlotDetails('A10'); event.stopPropagation();">
                                        <span class="slot-number">A10</span>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A11" onclick="viewSlotDetails('A11'); event.stopPropagation();">
                                        <span class="slot-number">A11</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A12" onclick="viewSlotDetails('A12'); event.stopPropagation();">
                                        <span class="slot-number">A12</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A13" onclick="viewSlotDetails('A13'); event.stopPropagation();">
                                        <span class="slot-number">A13</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A14" onclick="viewSlotDetails('A14'); event.stopPropagation();">
                                        <span class="slot-number">A14</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A15" onclick="viewSlotDetails('A15'); event.stopPropagation();">
                                        <span class="slot-number">A15</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A16" onclick="viewSlotDetails('A16'); event.stopPropagation();">
                                        <span class="slot-number">A16</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A17" onclick="viewSlotDetails('A17'); event.stopPropagation();">
                                        <span class="slot-number">A17</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A18" onclick="viewSlotDetails('A18'); event.stopPropagation();">
                                        <span class="slot-number">A18</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A19" onclick="viewSlotDetails('A19'); event.stopPropagation();">
                                        <span class="slot-number">A19</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A20" onclick="viewSlotDetails('A20'); event.stopPropagation();">
                                        <span class="slot-number">A20</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A21" onclick="viewSlotDetails('A21'); event.stopPropagation();">
                                        <span class="slot-number">A21</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A22" onclick="viewSlotDetails('A22'); event.stopPropagation();">
                                        <span class="slot-number">A22</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A23" onclick="viewSlotDetails('A23'); event.stopPropagation();">
                                        <span class="slot-number">A23</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A24" onclick="viewSlotDetails('A24'); event.stopPropagation();">
                                        <span class="slot-number">A24</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A25" onclick="viewSlotDetails('A25'); event.stopPropagation();">
                                        <span class="slot-number">A25</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A26" onclick="viewSlotDetails('A26'); event.stopPropagation();">
                                        <span class="slot-number">A26</span>
                                    </div>
                                    <div class="parking-slot motorcycle reserved" data-slot="A27" onclick="viewSlotDetails('A27'); event.stopPropagation();">
                                        <span class="slot-number">A27</span>
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A28" onclick="viewSlotDetails('A28'); event.stopPropagation();">
                                        <span class="slot-number">A28</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A29" onclick="viewSlotDetails('A29'); event.stopPropagation();">
                                        <span class="slot-number">A29</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A30" onclick="viewSlotDetails('A30'); event.stopPropagation();">
                                        <span class="slot-number">A30</span>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A31" onclick="viewSlotDetails('A31'); event.stopPropagation();">
                                        <span class="slot-number">A31</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A32" onclick="viewSlotDetails('A32'); event.stopPropagation();">
                                        <span class="slot-number">A32</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A33" onclick="viewSlotDetails('A33'); event.stopPropagation();">
                                        <span class="slot-number">A33</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A34" onclick="viewSlotDetails('A34'); event.stopPropagation();">
                                        <span class="slot-number">A34</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A35" onclick="viewSlotDetails('A35'); event.stopPropagation();">
                                        <span class="slot-number">A35</span>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A36" onclick="viewSlotDetails('A36'); event.stopPropagation();">
                                        <span class="slot-number">A36</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A37" onclick="viewSlotDetails('A37'); event.stopPropagation();">
                                        <span class="slot-number">A37</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A38" onclick="viewSlotDetails('A38'); event.stopPropagation();">
                                        <span class="slot-number">A38</span>
                                    </div>
                                    <div class="parking-slot motorcycle occupied" data-slot="A39" onclick="viewSlotDetails('A39'); event.stopPropagation();">
                                        <span class="slot-number">A39</span>
                                        <i class="fas fa-motorcycle"></i>
                                    </div>
                                    <div class="parking-slot motorcycle available" data-slot="A40" onclick="viewSlotDetails('A40'); event.stopPropagation();">
                                        <span class="slot-number">A40</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section B - Ô tô 4 chỗ -->
                        <div class="compact-section" id="section-b" onclick="toggleCompactSection('section-b', event)">
                            <div class="compact-section-header">
                                <div class="compact-section-icon car-icon">
                                    <i class="fas fa-car"></i>
                                </div>
                                <div class="compact-section-info">
                                    <h4 class="compact-section-title">Khu B - Ô tô 4 chỗ</h4>
                                    <div class="compact-section-stats">
                                        <span class="stat-badge available-badge">11 trống</span>
                                        <span class="stat-badge occupied-badge">8 đỗ</span>
                                        <span class="stat-badge maintenance-badge">1 bảo trì</span>
                                    </div>
                                </div>
                                <div class="compact-section-summary">
                                    <div class="summary-percentage">40%</div>
                                    <div class="summary-total">20 chỗ</div>
                                </div>
                                <button class="compact-expand-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="compact-progress-bar">
                                <div class="compact-progress-fill occupied-fill" style="width: 40%"></div>
                                <div class="compact-progress-fill maintenance-fill" style="width: 5%"></div>
                            </div>
                            
                            <!-- Expanded Content -->
                            <div class="compact-section-expanded" style="display: none;">
                                <div class="expanded-grid car-grid">
                                    <div class="parking-slot car occupied" data-slot="B01" onclick="viewSlotDetails('B01'); event.stopPropagation();">
                                        <span class="slot-number">B01</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B02" onclick="viewSlotDetails('B02'); event.stopPropagation();">
                                        <span class="slot-number">B02</span>
                                    </div>
                                    <div class="parking-slot car reserved" data-slot="B03" onclick="viewSlotDetails('B03'); event.stopPropagation();">
                                        <span class="slot-number">B03</span>
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B04" onclick="viewSlotDetails('B04'); event.stopPropagation();">
                                        <span class="slot-number">B04</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B05" onclick="viewSlotDetails('B05'); event.stopPropagation();">
                                        <span class="slot-number">B05</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B06" onclick="viewSlotDetails('B06'); event.stopPropagation();">
                                        <span class="slot-number">B06</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car maintenance" data-slot="B07" onclick="viewSlotDetails('B07'); event.stopPropagation();">
                                        <span class="slot-number">B07</span>
                                        <i class="fas fa-tools"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B08" onclick="viewSlotDetails('B08'); event.stopPropagation();">
                                        <span class="slot-number">B08</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B09" onclick="viewSlotDetails('B09'); event.stopPropagation();">
                                        <span class="slot-number">B09</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B10" onclick="viewSlotDetails('B10'); event.stopPropagation();">
                                        <span class="slot-number">B10</span>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B11" onclick="viewSlotDetails('B11'); event.stopPropagation();">
                                        <span class="slot-number">B11</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B12" onclick="viewSlotDetails('B12'); event.stopPropagation();">
                                        <span class="slot-number">B12</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B13" onclick="viewSlotDetails('B13'); event.stopPropagation();">
                                        <span class="slot-number">B13</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B14" onclick="viewSlotDetails('B14'); event.stopPropagation();">
                                        <span class="slot-number">B14</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B15" onclick="viewSlotDetails('B15'); event.stopPropagation();">
                                        <span class="slot-number">B15</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B16" onclick="viewSlotDetails('B16'); event.stopPropagation();">
                                        <span class="slot-number">B16</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B17" onclick="viewSlotDetails('B17'); event.stopPropagation();">
                                        <span class="slot-number">B17</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B18" onclick="viewSlotDetails('B18'); event.stopPropagation();">
                                        <span class="slot-number">B18</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="parking-slot car available" data-slot="B19" onclick="viewSlotDetails('B19'); event.stopPropagation();">
                                        <span class="slot-number">B19</span>
                                    </div>
                                    <div class="parking-slot car occupied" data-slot="B20" onclick="viewSlotDetails('B20'); event.stopPropagation();">
                                        <span class="slot-number">B20</span>
                                        <i class="fas fa-car"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section C - Ô tô 7 chỗ -->
                        <div class="compact-section" id="section-c" onclick="toggleCompactSection('section-c', event)">
                            <div class="compact-section-header">
                                <div class="compact-section-icon suv-icon">
                                    <i class="fas fa-shuttle-van"></i>
                                </div>
                                <div class="compact-section-info">
                                    <h4 class="compact-section-title">Khu C - Ô tô 7 chỗ / SUV</h4>
                                    <div class="compact-section-stats">
                                        <span class="stat-badge available-badge">7 trống</span>
                                        <span class="stat-badge occupied-badge">4 đỗ</span>
                                        <span class="stat-badge reserved-badge">1 đặt</span>
                                    </div>
                                </div>
                                <div class="compact-section-summary">
                                    <div class="summary-percentage">33%</div>
                                    <div class="summary-total">12 chỗ</div>
                                </div>
                                <button class="compact-expand-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="compact-progress-bar">
                                <div class="compact-progress-fill occupied-fill" style="width: 33%"></div>
                                <div class="compact-progress-fill reserved-fill" style="width: 8.3%"></div>
                            </div>
                            
                            <!-- Expanded Content -->
                            <div class="compact-section-expanded" style="display: none;">
                                <div class="expanded-grid suv-grid">
                                    <div class="parking-slot suv occupied" data-slot="C01" onclick="viewSlotDetails('C01'); event.stopPropagation();">
                                        <span class="slot-number">C01</span>
                                        <i class="fas fa-shuttle-van"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C02" onclick="viewSlotDetails('C02'); event.stopPropagation();">
                                        <span class="slot-number">C02</span>
                                    </div>
                                    <div class="parking-slot suv occupied" data-slot="C03" onclick="viewSlotDetails('C03'); event.stopPropagation();">
                                        <span class="slot-number">C03</span>
                                        <i class="fas fa-shuttle-van"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C04" onclick="viewSlotDetails('C04'); event.stopPropagation();">
                                        <span class="slot-number">C04</span>
                                    </div>
                                    <div class="parking-slot suv reserved" data-slot="C05" onclick="viewSlotDetails('C05'); event.stopPropagation();">
                                        <span class="slot-number">C05</span>
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C06" onclick="viewSlotDetails('C06'); event.stopPropagation();">
                                        <span class="slot-number">C06</span>
                                    </div>
                                    <div class="parking-slot suv occupied" data-slot="C07" onclick="viewSlotDetails('C07'); event.stopPropagation();">
                                        <span class="slot-number">C07</span>
                                        <i class="fas fa-shuttle-van"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C08" onclick="viewSlotDetails('C08'); event.stopPropagation();">
                                        <span class="slot-number">C08</span>
                                    </div>
                                    <div class="parking-slot suv occupied" data-slot="C09" onclick="viewSlotDetails('C09'); event.stopPropagation();">
                                        <span class="slot-number">C09</span>
                                        <i class="fas fa-shuttle-van"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C10" onclick="viewSlotDetails('C10'); event.stopPropagation();">
                                        <span class="slot-number">C10</span>
                                    </div>
                                    <div class="parking-slot suv occupied" data-slot="C11" onclick="viewSlotDetails('C11'); event.stopPropagation();">
                                        <span class="slot-number">C11</span>
                                        <i class="fas fa-shuttle-van"></i>
                                    </div>
                                    <div class="parking-slot suv available" data-slot="C12" onclick="viewSlotDetails('C12'); event.stopPropagation();">
                                        <span class="slot-number">C12</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section D - Xe tải -->
                        <div class="compact-section" id="section-d" onclick="toggleCompactSection('section-d', event)">
                            <div class="compact-section-header">
                                <div class="compact-section-icon truck-icon">
                                    <i class="fas fa-truck"></i>
                                </div>
                                <div class="compact-section-info">
                                    <h4 class="compact-section-title">Khu D - Xe tải</h4>
                                    <div class="compact-section-stats">
                                        <span class="stat-badge available-badge">4 trống</span>
                                        <span class="stat-badge occupied-badge">4 đỗ</span>
                                    </div>
                                </div>
                                <div class="compact-section-summary">
                                    <div class="summary-percentage">50%</div>
                                    <div class="summary-total">8 chỗ</div>
                                </div>
                                <button class="compact-expand-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="compact-progress-bar">
                                <div class="compact-progress-fill occupied-fill" style="width: 50%"></div>
                            </div>
                            
                            <!-- Expanded Content -->
                            <div class="compact-section-expanded" style="display: none;">
                                <div class="expanded-grid truck-grid">
                                    <div class="parking-slot truck occupied" data-slot="D01" onclick="viewSlotDetails('D01'); event.stopPropagation();">
                                        <span class="slot-number">D01</span>
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="parking-slot truck available" data-slot="D02" onclick="viewSlotDetails('D02'); event.stopPropagation();">
                                        <span class="slot-number">D02</span>
                                    </div>
                                    <div class="parking-slot truck occupied" data-slot="D03" onclick="viewSlotDetails('D03'); event.stopPropagation();">
                                        <span class="slot-number">D03</span>
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="parking-slot truck available" data-slot="D04" onclick="viewSlotDetails('D04'); event.stopPropagation();">
                                        <span class="slot-number">D04</span>
                                    </div>
                                    <div class="parking-slot truck occupied" data-slot="D05" onclick="viewSlotDetails('D05'); event.stopPropagation();">
                                        <span class="slot-number">D05</span>
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="parking-slot truck available" data-slot="D06" onclick="viewSlotDetails('D06'); event.stopPropagation();">
                                        <span class="slot-number">D06</span>
                                    </div>
                                    <div class="parking-slot truck available" data-slot="D07" onclick="viewSlotDetails('D07'); event.stopPropagation();">
                                        <span class="slot-number">D07</span>
                                    </div>
                                    <div class="parking-slot truck occupied" data-slot="D08" onclick="viewSlotDetails('D08'); event.stopPropagation();">
                                        <span class="slot-number">D08</span>
                                        <i class="fas fa-truck"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Parking Map Grid (Detail View) -->
                <div class="parking-map" id="detailView">
                    <!-- Section A - Xe máy -->
                    <div class="parking-section">
                        <div class="section-header">
                            <i class="fas fa-motorcycle"></i>
                            Khu A - Xe máy (40 chỗ)
                        </div>
                        <div class="parking-grid motorcycle-grid">
                            <!-- Row 1 -->
                            <div class="parking-slot motorcycle available" data-slot="A01" onclick="viewSlotDetails('A01')">
                                <span class="slot-number">A01</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A02" onclick="viewSlotDetails('A02')">
                                <span class="slot-number">A02</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A03" onclick="viewSlotDetails('A03')">
                                <span class="slot-number">A03</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A04" onclick="viewSlotDetails('A04')">
                                <span class="slot-number">A04</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A05" onclick="viewSlotDetails('A05')">
                                <span class="slot-number">A05</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A06" onclick="viewSlotDetails('A06')">
                                <span class="slot-number">A06</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A07" onclick="viewSlotDetails('A07')">
                                <span class="slot-number">A07</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A08" onclick="viewSlotDetails('A08')">
                                <span class="slot-number">A08</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A09" onclick="viewSlotDetails('A09')">
                                <span class="slot-number">A09</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A10" onclick="viewSlotDetails('A10')">
                                <span class="slot-number">A10</span>
                            </div>
                            <!-- Row 2 -->
                            <div class="parking-slot motorcycle available" data-slot="A11" onclick="viewSlotDetails('A11')">
                                <span class="slot-number">A11</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A12" onclick="viewSlotDetails('A12')">
                                <span class="slot-number">A12</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A13" onclick="viewSlotDetails('A13')">
                                <span class="slot-number">A13</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A14" onclick="viewSlotDetails('A14')">
                                <span class="slot-number">A14</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A15" onclick="viewSlotDetails('A15')">
                                <span class="slot-number">A15</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A16" onclick="viewSlotDetails('A16')">
                                <span class="slot-number">A16</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A17" onclick="viewSlotDetails('A17')">
                                <span class="slot-number">A17</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A18" onclick="viewSlotDetails('A18')">
                                <span class="slot-number">A18</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A19" onclick="viewSlotDetails('A19')">
                                <span class="slot-number">A19</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A20" onclick="viewSlotDetails('A20')">
                                <span class="slot-number">A20</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <!-- Row 3 -->
                            <div class="parking-slot motorcycle occupied" data-slot="A21" onclick="viewSlotDetails('A21')">
                                <span class="slot-number">A21</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A22" onclick="viewSlotDetails('A22')">
                                <span class="slot-number">A22</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A23" onclick="viewSlotDetails('A23')">
                                <span class="slot-number">A23</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A24" onclick="viewSlotDetails('A24')">
                                <span class="slot-number">A24</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A25" onclick="viewSlotDetails('A25')">
                                <span class="slot-number">A25</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A26" onclick="viewSlotDetails('A26')">
                                <span class="slot-number">A26</span>
                            </div>
                            <div class="parking-slot motorcycle reserved" data-slot="A27" onclick="viewSlotDetails('A27')">
                                <span class="slot-number">A27</span>
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A28" onclick="viewSlotDetails('A28')">
                                <span class="slot-number">A28</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A29" onclick="viewSlotDetails('A29')">
                                <span class="slot-number">A29</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A30" onclick="viewSlotDetails('A30')">
                                <span class="slot-number">A30</span>
                            </div>
                            <!-- Row 4 -->
                            <div class="parking-slot motorcycle available" data-slot="A31" onclick="viewSlotDetails('A31')">
                                <span class="slot-number">A31</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A32" onclick="viewSlotDetails('A32')">
                                <span class="slot-number">A32</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A33" onclick="viewSlotDetails('A33')">
                                <span class="slot-number">A33</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A34" onclick="viewSlotDetails('A34')">
                                <span class="slot-number">A34</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A35" onclick="viewSlotDetails('A35')">
                                <span class="slot-number">A35</span>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A36" onclick="viewSlotDetails('A36')">
                                <span class="slot-number">A36</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A37" onclick="viewSlotDetails('A37')">
                                <span class="slot-number">A37</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A38" onclick="viewSlotDetails('A38')">
                                <span class="slot-number">A38</span>
                            </div>
                            <div class="parking-slot motorcycle occupied" data-slot="A39" onclick="viewSlotDetails('A39')">
                                <span class="slot-number">A39</span>
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="parking-slot motorcycle available" data-slot="A40" onclick="viewSlotDetails('A40')">
                                <span class="slot-number">A40</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section B - Ô tô 4 chỗ -->
                    <div class="parking-section">
                        <div class="section-header">
                            <i class="fas fa-car"></i>
                            Khu B - Ô tô 4 chỗ (20 chỗ)
                        </div>
                        <div class="parking-grid car-grid">
                            <!-- Row 1 -->
                            <div class="parking-slot car occupied" data-slot="B01" onclick="viewSlotDetails('B01')">
                                <span class="slot-number">B01</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B02" onclick="viewSlotDetails('B02')">
                                <span class="slot-number">B02</span>
                            </div>
                            <div class="parking-slot car reserved" data-slot="B03" onclick="viewSlotDetails('B03')">
                                <span class="slot-number">B03</span>
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B04" onclick="viewSlotDetails('B04')">
                                <span class="slot-number">B04</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B05" onclick="viewSlotDetails('B05')">
                                <span class="slot-number">B05</span>
                            </div>
                            <!-- Row 2 -->
                            <div class="parking-slot car occupied" data-slot="B06" onclick="viewSlotDetails('B06')">
                                <span class="slot-number">B06</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car maintenance" data-slot="B07" onclick="viewSlotDetails('B07')">
                                <span class="slot-number">B07</span>
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B08" onclick="viewSlotDetails('B08')">
                                <span class="slot-number">B08</span>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B09" onclick="viewSlotDetails('B09')">
                                <span class="slot-number">B09</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B10" onclick="viewSlotDetails('B10')">
                                <span class="slot-number">B10</span>
                            </div>
                            <!-- Row 3 -->
                            <div class="parking-slot car available" data-slot="B11" onclick="viewSlotDetails('B11')">
                                <span class="slot-number">B11</span>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B12" onclick="viewSlotDetails('B12')">
                                <span class="slot-number">B12</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B13" onclick="viewSlotDetails('B13')">
                                <span class="slot-number">B13</span>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B14" onclick="viewSlotDetails('B14')">
                                <span class="slot-number">B14</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B15" onclick="viewSlotDetails('B15')">
                                <span class="slot-number">B15</span>
                            </div>
                            <!-- Row 4 -->
                            <div class="parking-slot car occupied" data-slot="B16" onclick="viewSlotDetails('B16')">
                                <span class="slot-number">B16</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B17" onclick="viewSlotDetails('B17')">
                                <span class="slot-number">B17</span>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B18" onclick="viewSlotDetails('B18')">
                                <span class="slot-number">B18</span>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="parking-slot car available" data-slot="B19" onclick="viewSlotDetails('B19')">
                                <span class="slot-number">B19</span>
                            </div>
                            <div class="parking-slot car occupied" data-slot="B20" onclick="viewSlotDetails('B20')">
                                <span class="slot-number">B20</span>
                                <i class="fas fa-car"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Section C - Ô tô 7 chỗ -->
                    <div class="parking-section">
                        <div class="section-header">
                            <i class="fas fa-shuttle-van"></i>
                            Khu C - Ô tô 7 chỗ / SUV (12 chỗ)
                        </div>
                        <div class="parking-grid suv-grid">
                            <!-- Row 1 -->
                            <div class="parking-slot suv occupied" data-slot="C01" onclick="viewSlotDetails('C01')">
                                <span class="slot-number">C01</span>
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C02" onclick="viewSlotDetails('C02')">
                                <span class="slot-number">C02</span>
                            </div>
                            <div class="parking-slot suv occupied" data-slot="C03" onclick="viewSlotDetails('C03')">
                                <span class="slot-number">C03</span>
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C04" onclick="viewSlotDetails('C04')">
                                <span class="slot-number">C04</span>
                            </div>
                            <!-- Row 2 -->
                            <div class="parking-slot suv reserved" data-slot="C05" onclick="viewSlotDetails('C05')">
                                <span class="slot-number">C05</span>
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C06" onclick="viewSlotDetails('C06')">
                                <span class="slot-number">C06</span>
                            </div>
                            <div class="parking-slot suv occupied" data-slot="C07" onclick="viewSlotDetails('C07')">
                                <span class="slot-number">C07</span>
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C08" onclick="viewSlotDetails('C08')">
                                <span class="slot-number">C08</span>
                            </div>
                            <!-- Row 3 -->
                            <div class="parking-slot suv occupied" data-slot="C09" onclick="viewSlotDetails('C09')">
                                <span class="slot-number">C09</span>
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C10" onclick="viewSlotDetails('C10')">
                                <span class="slot-number">C10</span>
                            </div>
                            <div class="parking-slot suv occupied" data-slot="C11" onclick="viewSlotDetails('C11')">
                                <span class="slot-number">C11</span>
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="parking-slot suv available" data-slot="C12" onclick="viewSlotDetails('C12')">
                                <span class="slot-number">C12</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section D - Xe tải -->
                    <div class="parking-section">
                        <div class="section-header">
                            <i class="fas fa-truck"></i>
                            Khu D - Xe tải (8 chỗ)
                        </div>
                        <div class="parking-grid truck-grid">
                            <!-- Row 1 -->
                            <div class="parking-slot truck occupied" data-slot="D01" onclick="viewSlotDetails('D01')">
                                <span class="slot-number">D01</span>
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="parking-slot truck available" data-slot="D02" onclick="viewSlotDetails('D02')">
                                <span class="slot-number">D02</span>
                            </div>
                            <div class="parking-slot truck occupied" data-slot="D03" onclick="viewSlotDetails('D03')">
                                <span class="slot-number">D03</span>
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="parking-slot truck available" data-slot="D04" onclick="viewSlotDetails('D04')">
                                <span class="slot-number">D04</span>
                            </div>
                            <!-- Row 2 -->
                            <div class="parking-slot truck occupied" data-slot="D05" onclick="viewSlotDetails('D05')">
                                <span class="slot-number">D05</span>
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="parking-slot truck available" data-slot="D06" onclick="viewSlotDetails('D06')">
                                <span class="slot-number">D06</span>
                            </div>
                            <div class="parking-slot truck available" data-slot="D07" onclick="viewSlotDetails('D07')">
                                <span class="slot-number">D07</span>
                            </div>
                            <div class="parking-slot truck occupied" data-slot="D08" onclick="viewSlotDetails('D08')">
                                <span class="slot-number">D08</span>
                                <i class="fas fa-truck"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar -->
    <div class="col-lg-4">
        <!-- Gate Status -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Trạng thái cổng</h3>
            </div>
            <div class="gate-status-list">
                <div class="gate-status-item">
                    <div class="gate-info">
                        <div class="gate-icon active" id="gate-in-a-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div>
                            <div class="gate-name">Cổng vào A</div>
                            <div class="gate-stats">
                                <span class="badge badge-success" id="gate-in-a-status">Đang mở</span>
                                <span class="gate-count">124 xe/ngày</span>
                            </div>
                        </div>
                    </div>
                    <div class="gate-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewGateCamera('gate-in-a')" title="Xem camera">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="btn-gate-in-a" onclick="toggleGate('gate-in-a', 'Cổng vào A')" title="Đóng cổng">
                            <i class="fas fa-lock"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="maintenanceGate('gate-in-a', 'Cổng vào A')" title="Bảo trì">
                            <i class="fas fa-tools"></i>
                        </button>
                    </div>
                </div>

                <div class="gate-status-item">
                    <div class="gate-info">
                        <div class="gate-icon active" id="gate-in-b-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div>
                            <div class="gate-name">Cổng vào B</div>
                            <div class="gate-stats">
                                <span class="badge badge-success" id="gate-in-b-status">Đang mở</span>
                                <span class="gate-count">98 xe/ngày</span>
                            </div>
                        </div>
                    </div>
                    <div class="gate-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewGateCamera('gate-in-b')" title="Xem camera">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="btn-gate-in-b" onclick="toggleGate('gate-in-b', 'Cổng vào B')" title="Đóng cổng">
                            <i class="fas fa-lock"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="maintenanceGate('gate-in-b', 'Cổng vào B')" title="Bảo trì">
                            <i class="fas fa-tools"></i>
                        </button>
                    </div>
                </div>

                <div class="gate-status-item">
                    <div class="gate-info">
                        <div class="gate-icon active" id="gate-out-a-icon">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <div>
                            <div class="gate-name">Cổng ra A</div>
                            <div class="gate-stats">
                                <span class="badge badge-success" id="gate-out-a-status">Đang mở</span>
                                <span class="gate-count">112 xe/ngày</span>
                            </div>
                        </div>
                    </div>
                    <div class="gate-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewGateCamera('gate-out-a')" title="Xem camera">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="btn-gate-out-a" onclick="toggleGate('gate-out-a', 'Cổng ra A')" title="Đóng cổng">
                            <i class="fas fa-lock"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="maintenanceGate('gate-out-a', 'Cổng ra A')" title="Bảo trì">
                            <i class="fas fa-tools"></i>
                        </button>
                    </div>
                </div>

                <div class="gate-status-item">
                    <div class="gate-info">
                        <div class="gate-icon active" id="gate-out-b-icon">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <div>
                            <div class="gate-name">Cổng ra B</div>
                            <div class="gate-stats">
                                <span class="badge badge-success" id="gate-out-b-status">Đang mở</span>
                                <span class="gate-count">95 xe/ngày</span>
                            </div>
                        </div>
                    </div>
                    <div class="gate-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewGateCamera('gate-out-b')" title="Xem camera">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="btn-gate-out-b" onclick="toggleGate('gate-out-b', 'Cổng ra B')" title="Đóng cổng">
                            <i class="fas fa-lock"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="maintenanceGate('gate-out-b', 'Cổng ra B')" title="Bảo trì">
                            <i class="fas fa-tools"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Counter Status -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Chốt thu phí</h3>
            </div>
            <div class="counter-status-list">
                <div class="counter-status-item">
                    <div class="counter-icon active" id="counter-1-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <div class="counter-info">
                        <div class="counter-name">Quầy 1</div>
                        <div class="counter-staff">NV: Nguyễn Văn A</div>
                        <div class="counter-revenue">2.5M VNĐ</div>
                    </div>
                    <div class="counter-status">
                        <span class="status-indicator online" id="counter-1-indicator"></span>
                        <span class="status-text" id="counter-1-text">Đang hoạt động</span>
                    </div>
                    <div class="counter-actions">
                        <button class="btn btn-sm btn-outline-danger" id="btn-counter-1" onclick="toggleCounter('counter-1', 'Quầy 1')" title="Đóng quầy">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                </div>

                <div class="counter-status-item">
                    <div class="counter-icon active" id="counter-2-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <div class="counter-info">
                        <div class="counter-name">Quầy 2</div>
                        <div class="counter-staff">NV: Trần Thị B</div>
                        <div class="counter-revenue">1.8M VNĐ</div>
                    </div>
                    <div class="counter-status">
                        <span class="status-indicator online" id="counter-2-indicator"></span>
                        <span class="status-text" id="counter-2-text">Đang hoạt động</span>
                    </div>
                    <div class="counter-actions">
                        <button class="btn btn-sm btn-outline-danger" id="btn-counter-2" onclick="toggleCounter('counter-2', 'Quầy 2')" title="Đóng quầy">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                </div>

                <div class="counter-status-item">
                    <div class="counter-icon inactive" id="counter-3-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <div class="counter-info">
                        <div class="counter-name">Quầy 3</div>
                        <div class="counter-staff">NV: Chưa phân công</div>
                        <div class="counter-revenue">0 VNĐ</div>
                    </div>
                    <div class="counter-status">
                        <span class="status-indicator offline" id="counter-3-indicator"></span>
                        <span class="status-text" id="counter-3-text">Không hoạt động</span>
                    </div>
                    <div class="counter-actions">
                        <button class="btn btn-sm btn-outline-success" id="btn-counter-3" onclick="toggleCounter('counter-3', 'Quầy 3')" title="Mở quầy">
                            <i class="fas fa-check-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Activity -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Hoạt động trực tiếp</h3>
            </div>
            <div class="activity-list">
                <div class="activity-item">
                    <div class="activity-icon entry">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Xe vào: <strong>29B1-12345</strong></div>
                        <div class="activity-time">2 phút trước</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon exit">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Xe ra: <strong>30A-98765</strong></div>
                        <div class="activity-time">5 phút trước</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon payment">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Thanh toán: <strong>15,000 VNĐ</strong></div>
                        <div class="activity-time">7 phút trước</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon entry">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Xe vào: <strong>51G-11111</strong></div>
                        <div class="activity-time">10 phút trước</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Overview Map Modal -->
<div class="modal fade" id="overviewMapModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-map-marked-alt"></i>
                    Bản đồ tổng quan bãi đỗ xe
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <!-- Parking Lot Map -->
                <div class="parking-lot-map">
                    <!-- Title -->
                    <div class="map-title text-center mb-4">
                        <h4>BÃI ĐỖ XE THÔNG MINH</h4>
                        <p class="text-muted">Tổng 80 chỗ - 38 trống - 39 đang đỗ - 3 đặt/bảo trì</p>
                    </div>

                    <!-- Map Container with roads and arrows -->
                    <div class="map-container">
                        <!-- Top Section - Entry Gates -->
                        <div class="map-row entrance-row">
                            <!-- Gate In A -->
                            <div class="map-gate gate-in-left">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>CỔNG VÀO A</span>
                                <div class="gate-arrow">↓</div>
                            </div>

                            <div class="map-spacer"></div>

                            <!-- Gate In B -->
                            <div class="map-gate gate-in-right">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>CỔNG VÀO B</span>
                                <div class="gate-arrow">↓</div>
                            </div>
                        </div>

                        <!-- Main Road Horizontal -->
                        <div class="road-horizontal main-road">
                            <div class="road-arrow-left">←</div>
                            <div class="road-label">ĐƯỜNG CHÍNH</div>
                            <div class="road-arrow-right">→</div>
                        </div>

                        <!-- Parking Areas Row 1 -->
                        <div class="map-row parking-row">
                            <!-- Khu A - Xe máy (Bên trái) -->
                            <div class="parking-zone zone-a">
                                <div class="zone-header">
                                    <i class="fas fa-motorcycle"></i>
                                    <strong>KHU A</strong>
                                    <span>Xe máy</span>
                                </div>
                                <div class="zone-body">
                                    <div class="zone-grid motorcycle-mini"></div>
                                    <div class="zone-stats">
                                        <span class="stat-available">15 trống</span>
                                        <span class="stat-occupied">24 đỗ</span>
                                        <span class="stat-reserved">1 đặt</span>
                                    </div>
                                    <div class="zone-capacity-bar">
                                        <div class="zone-fill" style="width: 60%"></div>
                                    </div>
                                    <div class="zone-capacity-text">40 chỗ (60%)</div>
                                </div>
                                <div class="zone-arrow-in">↓</div>
                            </div>

                            <!-- Vertical Road -->
                            <div class="road-vertical">
                                <div class="road-arrow-up">↑</div>
                                <div class="road-arrow-down">↓</div>
                            </div>

                            <!-- Khu B - Ô tô 4 chỗ (Bên phải) -->
                            <div class="parking-zone zone-b">
                                <div class="zone-header">
                                    <i class="fas fa-car"></i>
                                    <strong>KHU B</strong>
                                    <span>Ô tô 4 chỗ</span>
                                </div>
                                <div class="zone-body">
                                    <div class="zone-grid car-mini"></div>
                                    <div class="zone-stats">
                                        <span class="stat-available">11 trống</span>
                                        <span class="stat-occupied">8 đỗ</span>
                                        <span class="stat-maintenance">1 bảo trì</span>
                                    </div>
                                    <div class="zone-capacity-bar">
                                        <div class="zone-fill" style="width: 40%"></div>
                                    </div>
                                    <div class="zone-capacity-text">20 chỗ (40%)</div>
                                </div>
                                <div class="zone-arrow-in">↓</div>
                            </div>
                        </div>

                        <!-- Counter Area (Giữa) -->
                        <div class="counter-area">
                            <div class="counter-box active">
                                <i class="fas fa-cash-register"></i>
                                <span>QUẦY 1</span>
                            </div>
                            <div class="counter-box active">
                                <i class="fas fa-cash-register"></i>
                                <span>QUẦY 2</span>
                            </div>
                            <div class="counter-box inactive">
                                <i class="fas fa-cash-register"></i>
                                <span>QUẦY 3</span>
                            </div>
                        </div>

                        <!-- Parking Areas Row 2 -->
                        <div class="map-row parking-row">
                            <!-- Khu C - Ô tô 7 chỗ (Bên trái) -->
                            <div class="parking-zone zone-c">
                                <div class="zone-arrow-out">↑</div>
                                <div class="zone-header">
                                    <i class="fas fa-shuttle-van"></i>
                                    <strong>KHU C</strong>
                                    <span>Ô tô 7 chỗ/SUV</span>
                                </div>
                                <div class="zone-body">
                                    <div class="zone-grid suv-mini"></div>
                                    <div class="zone-stats">
                                        <span class="stat-available">7 trống</span>
                                        <span class="stat-occupied">4 đỗ</span>
                                        <span class="stat-reserved">1 đặt</span>
                                    </div>
                                    <div class="zone-capacity-bar">
                                        <div class="zone-fill" style="width: 33%"></div>
                                    </div>
                                    <div class="zone-capacity-text">12 chỗ (33%)</div>
                                </div>
                            </div>

                            <!-- Vertical Road -->
                            <div class="road-vertical">
                                <div class="road-arrow-up">↑</div>
                                <div class="road-arrow-down">↓</div>
                            </div>

                            <!-- Khu D - Xe tải (Bên phải) -->
                            <div class="parking-zone zone-d">
                                <div class="zone-arrow-out">↑</div>
                                <div class="zone-header">
                                    <i class="fas fa-truck"></i>
                                    <strong>KHU D</strong>
                                    <span>Xe tải</span>
                                </div>
                                <div class="zone-body">
                                    <div class="zone-grid truck-mini"></div>
                                    <div class="zone-stats">
                                        <span class="stat-available">4 trống</span>
                                        <span class="stat-occupied">4 đỗ</span>
                                    </div>
                                    <div class="zone-capacity-bar">
                                        <div class="zone-fill" style="width: 50%"></div>
                                    </div>
                                    <div class="zone-capacity-text">8 chỗ (50%)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Exit Road Horizontal -->
                        <div class="road-horizontal exit-road">
                            <div class="road-arrow-left">←</div>
                            <div class="road-label">ĐƯỜNG RA</div>
                            <div class="road-arrow-right">→</div>
                        </div>

                        <!-- Bottom Section - Exit Gates -->
                        <div class="map-row exit-row">
                            <!-- Gate Out A -->
                            <div class="map-gate gate-out-left">
                                <div class="gate-arrow">↑</div>
                                <i class="fas fa-sign-out-alt"></i>
                                <span>CỔNG RA A</span>
                            </div>

                            <div class="map-spacer"></div>

                            <!-- Gate Out B -->
                            <div class="map-gate gate-out-right">
                                <div class="gate-arrow">↑</div>
                                <i class="fas fa-sign-out-alt"></i>
                                <span>CỔNG RA B</span>
                            </div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="map-legend mt-4">
                        <div class="legend-title">CHÚ THÍCH:</div>
                        <div class="legend-items">
                            <div class="legend-item">
                                <div class="legend-box" style="background: #87DF2C;"></div>
                                <span>Cổng vào (mở)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #21A691;"></div>
                                <span>Cổng ra (mở)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: repeating-linear-gradient(45deg, #e74c3c, #e74c3c 5px, #fff 5px, #fff 10px); border: 1px solid #c0392b;"></div>
                                <span>Thanh chắn (cổng đóng)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #ff9800;"></div>
                                <span>Cổng bảo trì</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #ddd; border: 2px dashed #666;"></div>
                                <span>Đường đi</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #f0f0f0; border: 2px solid #21A691;"></div>
                                <span>Khu đỗ xe</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #21A691;"></div>
                                <span>Quầy hoạt động</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box" style="background: #95a5a6;"></div>
                                <span>Quầy đóng</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Đóng
                </button>
                <button type="button" class="btn btn-primary" onclick="printOverviewMap()">
                    <i class="fas fa-print"></i>
                    In bản đồ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Slot Details Modal -->
<div class="modal fade" id="slotDetailsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chi tiết chỗ đỗ <span id="modalSlotNumber"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="slot-details-content">
                    <div class="detail-row">
                        <span class="detail-label">Trạng thái:</span>
                        <span class="detail-value" id="modalSlotStatus"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Loại xe:</span>
                        <span class="detail-value" id="modalVehicleType"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Biển số:</span>
                        <span class="detail-value" id="modalLicensePlate"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Thời gian vào:</span>
                        <span class="detail-value" id="modalEntryTime"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Thời gian đỗ:</span>
                        <span class="detail-value" id="modalDuration"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phí tạm tính:</span>
                        <span class="detail-value" id="modalEstimatedFee"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="navigateToSlot()">
                    <i class="fas fa-route"></i>
                    Dẫn đường
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Navigation Modal -->
<div class="modal fade" id="navigationModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-route"></i>
                    Dẫn đường đến chỗ đỗ <span id="navSlotNumber"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Map with route -->
                    <div class="col-lg-8">
                        <div class="navigation-map-container">
                            <div class="navigation-info-bar">
                                <div class="nav-info-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>Vị trí: <strong id="navSlotLocation"></strong></span>
                                </div>
                                <div class="nav-info-item">
                                    <i class="fas fa-route"></i>
                                    <span>Khoảng cách: <strong id="navDistance"></strong></span>
                                </div>
                                <div class="nav-info-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Thời gian: <strong id="navTime"></strong></span>
                                </div>
                            </div>
                            
                            <!-- Navigation Map -->
                            <div class="navigation-map" id="navigationMap">
                                <!-- Entry point -->
                                <div class="nav-entry-point" id="navEntryPoint">
                                    <i class="fas fa-flag"></i>
                                    <span>Bắt đầu</span>
                                </div>
                                
                                <!-- Route path will be drawn here -->
                                <svg class="route-svg" id="routeSvg">
                                    <!-- Path will be dynamically created -->
                                </svg>
                                
                                <!-- Zones -->
                                <div class="nav-zone zone-a-nav" data-zone="A">
                                    <div class="nav-zone-label">
                                        <i class="fas fa-motorcycle"></i>
                                        <span>Khu A</span>
                                    </div>
                                </div>
                                
                                <div class="nav-zone zone-b-nav" data-zone="B">
                                    <div class="nav-zone-label">
                                        <i class="fas fa-car"></i>
                                        <span>Khu B</span>
                                    </div>
                                </div>
                                
                                <div class="nav-zone zone-c-nav" data-zone="C">
                                    <div class="nav-zone-label">
                                        <i class="fas fa-shuttle-van"></i>
                                        <span>Khu C</span>
                                    </div>
                                </div>
                                
                                <div class="nav-zone zone-d-nav" data-zone="D">
                                    <div class="nav-zone-label">
                                        <i class="fas fa-truck"></i>
                                        <span>Khu D</span>
                                    </div>
                                </div>
                                
                                <!-- Target slot marker -->
                                <div class="nav-target-marker" id="navTargetMarker">
                                    <div class="marker-pulse"></div>
                                    <i class="fas fa-map-pin"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step by step directions -->
                    <div class="col-lg-4">
                        <div class="navigation-steps-container">
                            <h6 class="steps-title">
                                <i class="fas fa-list-ol"></i>
                                Hướng dẫn từng bước
                            </h6>
                            <div class="navigation-steps" id="navigationSteps">
                                <!-- Steps will be dynamically added -->
                            </div>
                            
                            <div class="navigation-legend mt-3">
                                <h6 class="legend-title-small">Chú thích:</h6>
                                <div class="legend-items-small">
                                    <div class="legend-item-small">
                                        <i class="fas fa-flag" style="color: #87DF2C;"></i>
                                        <span>Điểm bắt đầu</span>
                                    </div>
                                    <div class="legend-item-small">
                                        <i class="fas fa-map-pin" style="color: #e74c3c;"></i>
                                        <span>Vị trí đỗ</span>
                                    </div>
                                    <div class="legend-item-small">
                                        <div style="width: 20px; height: 3px; background: #21A691; border-radius: 2px;"></div>
                                        <span>Đường đi</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Đóng
                </button>
                <button type="button" class="btn btn-success" onclick="printNavigation()">
                    <i class="fas fa-print"></i>
                    In hướng dẫn
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Camera View Modal -->
<div class="modal fade" id="cameraViewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-video"></i>
                    Camera giám sát - <span id="cameraTitle">Tất cả camera</span>
                </h5>
                <div class="camera-controls">
                    <button class="btn btn-sm btn-outline-primary" onclick="switchCameraView('all')" title="Xem tất cả">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshCameras()" title="Làm mới">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="toggleFullscreen()" title="Toàn màn hình">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-3">
                <!-- Camera Grid View -->
                <div id="cameraGridView" class="camera-grid">
                    <!-- Gate Cameras -->
                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="gate-in-a" onclick="switchToSingleCamera('gate-in-a')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Cổng vào A</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-gate-in-a"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/5_XSYlAfJZM?autoplay=1&mute=1&loop=1&playlist=5_XSYlAfJZM&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="gate-in-b" onclick="switchToSingleCamera('gate-in-b')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Cổng vào B</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-gate-in-b"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/Vrxyr1CjiSM?autoplay=1&mute=1&loop=1&playlist=Vrxyr1CjiSM&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="gate-out-a" onclick="switchToSingleCamera('gate-out-a')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Cổng ra A</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-gate-out-a"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/CevxZvSJLk8?autoplay=1&mute=1&loop=1&playlist=CevxZvSJLk8&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="gate-out-b" onclick="switchToSingleCamera('gate-out-b')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Cổng ra B</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-gate-out-b"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/jmRfToI-cC4?autoplay=1&mute=1&loop=1&playlist=jmRfToI-cC4&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <!-- Area Cameras -->
                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="area-a" onclick="switchToSingleCamera('area-a')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-motorcycle"></i>
                                    <span>Khu A - Xe máy</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-area-a"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/l_MyUGq7pgs?autoplay=1&mute=1&loop=1&playlist=l_MyUGq7pgs&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="area-b" onclick="switchToSingleCamera('area-b')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-car"></i>
                                    <span>Khu B - Ô tô 4 chỗ</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-area-b"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/MNn9qKG2UFI?autoplay=1&mute=1&loop=1&playlist=MNn9qKG2UFI&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="area-c" onclick="switchToSingleCamera('area-c')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-shuttle-van"></i>
                                    <span>Khu C - Ô tô 7 chỗ</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-area-c"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/NyLF8nHIquM?autoplay=1&mute=1&loop=1&playlist=NyLF8nHIquM&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="camera-feed-container">
                        <div class="camera-feed" data-camera="area-d" onclick="switchToSingleCamera('area-d')">
                            <div class="camera-overlay">
                                <div class="camera-label">
                                    <i class="fas fa-truck"></i>
                                    <span>Khu D - Xe tải</span>
                                </div>
                                <div class="camera-status">
                                    <span class="status-dot recording"></span>
                                    <span>REC</span>
                                </div>
                                <div class="camera-time" id="time-area-d"></div>
                            </div>
                            <div class="camera-placeholder">
                                <iframe width="100%" height="100%" 
                                    src="https://www.youtube.com/embed/1-b7RmmeLtk?autoplay=1&mute=1&loop=1&playlist=1-b7RmmeLtk&controls=0&modestbranding=1&rel=0" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Single Camera View -->
                <div id="cameraSingleView" class="camera-single-view" style="display: none;">
                    <div class="camera-feed-single">
                        <div class="camera-overlay">
                            <div class="camera-label">
                                <i class="fas fa-video" id="single-camera-icon"></i>
                                <span id="single-camera-name">Camera</span>
                            </div>
                            <div class="camera-status">
                                <span class="status-dot recording"></span>
                                <span>REC • HD 1080p</span>
                            </div>
                            <div class="camera-time" id="time-single"></div>
                        </div>
                        <div id="single-camera-content" class="camera-placeholder-single">
                            <!-- Video will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Camera Controls -->
                    <div class="camera-single-controls">
                        <button class="btn btn-sm btn-outline-light" onclick="captureSnapshot()" title="Chụp ảnh">
                            <i class="fas fa-camera"></i>
                            Chụp ảnh
                        </button>
                        <button class="btn btn-sm btn-outline-light" onclick="toggleRecording()" title="Ghi hình">
                            <i class="fas fa-circle"></i>
                            Ghi hình
                        </button>
                        <button class="btn btn-sm btn-outline-light" onclick="toggleSound()" title="Bật/Tắt âm thanh">
                            <i class="fas fa-volume-up"></i>
                            Âm thanh
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="camera-info">
                    <span class="badge bg-success">
                        <i class="fas fa-circle"></i>
                        <span id="active-cameras">8</span> camera hoạt động
                    </span>
                    <span class="badge bg-info ms-2">
                        <i class="fas fa-hdd"></i>
                        Lưu trữ: 45 GB / 500 GB
                    </span>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Đóng
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Parking Map Styles */
    .parking-map-container {
        padding: 20px;
    }

    .parking-legend {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .legend-color {
        width: 30px;
        height: 20px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    .legend-color.available {
        background-color: #87DF2C;
    }

    .legend-color.occupied {
        background-color: #ff6b6b;
    }

    .legend-color.reserved {
        background-color: #ffa500;
    }

    .legend-color.maintenance {
        background-color: #95a5a6;
    }

    .parking-map {
        margin-top: 20px;
    }

    .parking-section {
        margin-bottom: 30px;
    }

    .section-header {
        background: linear-gradient(135deg, #21A691 0%, #1a8274 100%);
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .parking-grid {
        display: grid;
        gap: 10px;
    }

    .motorcycle-grid {
        grid-template-columns: repeat(10, 1fr);
    }

    .car-grid {
        grid-template-columns: repeat(5, 1fr);
    }

    .suv-grid {
        grid-template-columns: repeat(4, 1fr);
    }

    .truck-grid {
        grid-template-columns: repeat(4, 1fr);
    }

    .parking-slot {
        border: 2px solid #ddd;
        border-radius: 6px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        padding: 6px;
        min-height: 50px;
    }

    /* Xe máy - hình chữ nhật nhỏ */
    .parking-slot.motorcycle {
        aspect-ratio: 4/3;
        min-height: 45px;
    }

    /* Ô tô 4 chỗ - trung bình */
    .parking-slot.car {
        aspect-ratio: 5/4;
        min-height: 60px;
    }

    /* Ô tô 7 chỗ - lớn hơn */
    .parking-slot.suv {
        aspect-ratio: 5/4;
        min-height: 70px;
    }

    /* Xe tải - to nhất */
    .parking-slot.truck {
        aspect-ratio: 6/5;
        min-height: 85px;
    }

    .parking-slot:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .parking-slot.available {
        background-color: #87DF2C;
        border-color: #76c91e;
        cursor: help;
    }

    .parking-slot.available:hover {
        transform: scale(1.03);
        box-shadow: 0 2px 8px rgba(135, 223, 44, 0.4);
    }

    .parking-slot.occupied {
        background-color: #ff6b6b;
        border-color: #ff5252;
    }

    .parking-slot.reserved {
        background-color: #ffa500;
        border-color: #ff9500;
    }

    .parking-slot.maintenance {
        background-color: #95a5a6;
        border-color: #7f8c8d;
        cursor: help;
    }

    .parking-slot.maintenance:hover {
        transform: scale(1.03);
    }

    .slot-number {
        font-weight: 700;
        font-size: 11px;
        color: white;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .parking-slot i {
        font-size: 16px;
        color: white;
        margin-top: 3px;
    }

    .parking-slot.motorcycle i {
        font-size: 12px;
    }

    .parking-slot.car i {
        font-size: 16px;
    }

    .parking-slot.suv i {
        font-size: 18px;
    }

    .parking-slot.truck i {
        font-size: 22px;
    }

    .gate-actions {
        display: flex;
        gap: 5px;
    }

    /* Gate Status Styles */
    .gate-status-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .gate-status-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        background-color: #f8f9fa;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .gate-status-item:hover {
        background-color: #e9ecef;
    }

    .gate-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .gate-icon {
        width: 45px;
        height: 45px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .gate-icon.active {
        background-color: rgba(33, 166, 145, 0.15);
        color: #21A691;
    }

    .gate-icon.warning {
        background-color: rgba(255, 152, 0, 0.15);
        color: #ff9800;
    }

    .gate-name {
        font-weight: 600;
        margin-bottom: 4px;
    }

    .gate-stats {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .gate-count {
        font-size: 12px;
        color: #6c757d;
    }

    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }

    .badge-success {
        background-color: #87DF2C;
        color: white;
    }

    .badge-warning {
        background-color: #ffa500;
        color: white;
    }

    /* Counter Status Styles */
    .counter-status-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .counter-status-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

    .counter-icon {
        width: 45px;
        height: 45px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .counter-icon.active {
        background-color: rgba(33, 166, 145, 0.15);
        color: #21A691;
    }

    .counter-icon.inactive {
        background-color: rgba(149, 165, 166, 0.15);
        color: #95a5a6;
    }

    .counter-info {
        flex: 1;
    }

    .counter-name {
        font-weight: 600;
        margin-bottom: 2px;
    }

    .counter-staff {
        font-size: 12px;
        color: #6c757d;
        margin-bottom: 2px;
    }

    .counter-revenue {
        font-size: 13px;
        font-weight: 600;
        color: #21A691;
    }

    .counter-status {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
    }

    .counter-actions {
        display: flex;
        gap: 5px;
    }

    .status-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    .status-indicator.online {
        background-color: #87DF2C;
        box-shadow: 0 0 8px rgba(135, 223, 44, 0.6);
    }

    .status-indicator.offline {
        background-color: #95a5a6;
    }

    .status-text {
        font-size: 11px;
        color: #6c757d;
    }

    /* Activity Styles */
    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .activity-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        border-left: 3px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .activity-item:hover {
        background-color: #f8f9fa;
        border-left-color: #21A691;
    }

    .activity-icon {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: white;
    }

    .activity-icon.entry {
        background-color: #87DF2C;
    }

    .activity-icon.exit {
        background-color: #ff9800;
    }

    .activity-icon.payment {
        background-color: #21A691;
    }

    .activity-details {
        flex: 1;
    }

    .activity-title {
        font-size: 13px;
        margin-bottom: 2px;
    }

    .activity-time {
        font-size: 11px;
        color: #6c757d;
    }

    /* Modal Styles */
    .slot-details-content {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
    }

    .detail-label {
        font-weight: 600;
        color: #495057;
    }

    .detail-value {
        color: #21A691;
        font-weight: 600;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .motorcycle-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        .car-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .suv-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .truck-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Compact View Styles */
    .compact-view {
        padding: 10px 0;
    }

    .compact-sections {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .compact-section {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .compact-section:hover {
        border-color: #21A691;
        box-shadow: 0 4px 12px rgba(33, 166, 145, 0.1);
        transform: translateY(-2px);
    }

    .compact-section-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 10px;
    }

    .compact-section-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
    }

    .compact-section-icon.motorcycle-icon {
        background: linear-gradient(135deg, #87DF2C 0%, #76c91e 100%);
    }

    .compact-section-icon.car-icon {
        background: linear-gradient(135deg, #21A691 0%, #1a8274 100%);
    }

    .compact-section-icon.suv-icon {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    .compact-section-icon.truck-icon {
        background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
    }

    .compact-section-info {
        flex: 1;
    }

    .compact-section-title {
        font-size: 16px;
        font-weight: 700;
        color: #2c3e50;
        margin: 0 0 8px 0;
    }

    .compact-section-stats {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .stat-badge {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        white-space: nowrap;
    }

    .stat-badge.available-badge {
        background: rgba(135, 223, 44, 0.15);
        color: #5a9216;
    }

    .stat-badge.occupied-badge {
        background: rgba(255, 107, 107, 0.15);
        color: #c92a2a;
    }

    .stat-badge.reserved-badge {
        background: rgba(255, 152, 0, 0.15);
        color: #e67700;
    }

    .stat-badge.maintenance-badge {
        background: rgba(149, 165, 166, 0.15);
        color: #7f8c8d;
    }

    .compact-section-summary {
        text-align: right;
        margin-right: 10px;
    }

    .summary-percentage {
        font-size: 24px;
        font-weight: 700;
        color: #21A691;
        line-height: 1;
    }

    .summary-total {
        font-size: 12px;
        color: #6c757d;
        margin-top: 2px;
    }

    .compact-expand-btn {
        background: none;
        border: none;
        color: #6c757d;
        font-size: 18px;
        cursor: pointer;
        padding: 5px 10px;
        transition: all 0.3s ease;
    }

    .compact-expand-btn:hover {
        color: #21A691;
    }

    .compact-progress-bar {
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        display: flex;
    }

    .compact-progress-fill {
        height: 100%;
        transition: width 0.3s ease;
    }

    .compact-progress-fill.occupied-fill {
        background: #ff6b6b;
    }

    .compact-progress-fill.reserved-fill {
        background: #ffa500;
    }

    .compact-progress-fill.maintenance-fill {
        background: #95a5a6;
    }

    /* Compact Section Expanded Content */
    .compact-section-expanded {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e9ecef;
        animation: expandSection 0.3s ease-out;
    }

    @@keyframes expandSection {
        from {
            opacity: 0;
            max-height: 0;
        }
        to {
            opacity: 1;
            max-height: 1000px;
        }
    }

    .compact-section.expanded .compact-expand-btn i {
        transform: rotate(180deg);
    }

    .compact-section.expanded {
        border-color: #21A691;
        box-shadow: 0 6px 20px rgba(33, 166, 145, 0.2);
    }

    .expanded-grid {
        display: grid;
        gap: 10px;
        padding: 10px 0;
    }

    .expanded-grid.motorcycle-grid {
        grid-template-columns: repeat(10, 1fr);
    }

    .expanded-grid.car-grid {
        grid-template-columns: repeat(5, 1fr);
    }

    .expanded-grid.suv-grid {
        grid-template-columns: repeat(4, 1fr);
    }

    .expanded-grid.truck-grid {
        grid-template-columns: repeat(4, 1fr);
    }

    /* Responsive for expanded grid */
    @@media (max-width: 768px) {
        .expanded-grid.motorcycle-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        .expanded-grid.car-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .expanded-grid.suv-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .expanded-grid.truck-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }


    /* Parking Lot Map Styles */
    .parking-lot-map {
        max-width: 100%;
        margin: 0 auto;
    }

    .map-title h4 {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 2px;
        font-size: 20px;
    }

    .map-title p {
        font-size: 12px;
        margin-bottom: 15px;
    }

    .map-container {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }

    /* Map Rows */
    .map-row {
        display: grid;
        grid-template-columns: 1fr 60px 1fr;
        gap: 10px;
        margin-bottom: 10px;
    }

    .map-spacer {
        grid-column: 2;
    }

    /* Gates */
    .map-gate {
        background: white;
        border-radius: 8px;
        padding: 8px 10px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 2px solid;
        position: relative;
        min-height: 85px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .gate-in-left, .gate-in-right {
        border-color: #87DF2C;
        background: linear-gradient(180deg, white 0%, rgba(135, 223, 44, 0.08) 100%);
    }

    .gate-out-left, .gate-out-right {
        border-color: #21A691;
        background: linear-gradient(180deg, rgba(33, 166, 145, 0.08) 0%, white 100%);
    }

    .map-gate.maintenance {
        border-color: #ff9800;
        opacity: 0.7;
        background: linear-gradient(180deg, rgba(255, 152, 0, 0.08) 0%, white 100%);
    }

    .map-gate.closed {
        border-color: #e74c3c;
        opacity: 0.85;
        background: linear-gradient(180deg, rgba(231, 76, 60, 0.08) 0%, white 100%);
    }

    .map-gate i {
        font-size: 24px;
        display: block;
        margin-bottom: 6px;
    }

    .gate-in-left i, .gate-in-right i {
        color: #87DF2C;
    }

    .gate-out-left i, .gate-out-right i {
        color: #21A691;
    }

    .map-gate.maintenance i {
        color: #ff9800;
    }

    .map-gate.closed i {
        color: #e74c3c;
    }

    .map-gate span {
        font-weight: 700;
        font-size: 11px;
        display: block;
        color: #2c3e50;
    }

    .map-gate small {
        font-size: 9px;
        display: block;
        margin-top: 3px;
    }

    .gate-arrow {
        font-size: 20px;
        font-weight: 700;
        color: #666;
        margin: 4px 0;
        animation: bounce 2s infinite;
    }

    /* Barrier (Thanh chắn) */
    .gate-barrier {
        position: absolute;
        width: 75%;
        height: 6px;
        background: repeating-linear-gradient(
            45deg,
            #e74c3c,
            #e74c3c 8px,
            #fff 8px,
            #fff 16px
        );
        border: 1.5px solid #c0392b;
        border-radius: 3px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        z-index: 10;
        transform-origin: left center;
        animation: barrierPulse 2s infinite;
    }

    .gate-in-left .gate-barrier,
    .gate-in-right .gate-barrier {
        bottom: 12px;
        left: 12.5%;
        transform: rotate(0deg);
    }

    .gate-out-left .gate-barrier,
    .gate-out-right .gate-barrier {
        top: 12px;
        left: 12.5%;
        transform: rotate(0deg);
    }

    @@keyframes barrierPulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.75;
        }
    }

    /* Roads */
    .road-horizontal {
        grid-column: 1 / -1;
        background: repeating-linear-gradient(
            90deg,
            #ddd,
            #ddd 12px,
            #fff 12px,
            #fff 24px
        );
        border: 2px dashed #888;
        border-radius: 5px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 15px;
        position: relative;
        margin: 8px 0;
    }

    .road-label {
        background: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-weight: 700;
        color: #333;
        border: 1.5px solid #888;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        font-size: 11px;
    }

    .road-arrow-left, .road-arrow-right {
        font-size: 20px;
        font-weight: 700;
        color: #666;
        animation: slide 2s infinite;
    }

    .road-vertical {
        background: repeating-linear-gradient(
            180deg,
            #ddd,
            #ddd 12px,
            #fff 12px,
            #fff 24px
        );
        border: 2px dashed #888;
        border-radius: 5px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-around;
        padding: 12px 0;
    }

    .road-arrow-up, .road-arrow-down {
        font-size: 20px;
        font-weight: 700;
        color: #666;
        animation: bounce 2s infinite;
    }

    /* Parking Zones */
    .parking-zone {
        background: white;
        border: 2px solid #21A691;
        border-radius: 8px;
        padding: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        position: relative;
    }

    .zone-header {
        background: linear-gradient(135deg, #21A691 0%, #1a8274 100%);
        color: white;
        padding: 6px;
        border-radius: 5px;
        text-align: center;
        margin-bottom: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
    }

    .zone-header i {
        font-size: 18px;
    }

    .zone-header strong {
        font-size: 12px;
        display: block;
    }

    .zone-header span {
        font-size: 9px;
        opacity: 0.9;
    }

    .zone-body {
        padding: 6px;
    }

    .zone-grid {
        height: 45px;
        background: repeating-linear-gradient(
            90deg,
            #f0f0f0,
            #f0f0f0 10px,
            #ddd 10px,
            #ddd 12px
        );
        border-radius: 5px;
        margin-bottom: 8px;
        border: 1.5px solid #ddd;
    }

    .zone-stats {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 6px;
    }

    .zone-stats span {
        font-size: 9px;
        padding: 2px 5px;
        border-radius: 8px;
        font-weight: 600;
        white-space: nowrap;
    }

    .stat-available {
        background: rgba(135, 223, 44, 0.2);
        color: #5a9216;
    }

    .stat-occupied {
        background: rgba(255, 107, 107, 0.2);
        color: #c92a2a;
    }

    .stat-reserved {
        background: rgba(255, 152, 0, 0.2);
        color: #e67700;
    }

    .stat-maintenance {
        background: rgba(149, 165, 166, 0.2);
        color: #7f8c8d;
    }

    .zone-capacity-bar {
        height: 5px;
        background: #e9ecef;
        border-radius: 2.5px;
        overflow: hidden;
        margin-bottom: 3px;
    }

    .zone-fill {
        height: 100%;
        background: #ff6b6b;
        transition: width 0.3s ease;
    }

    .zone-capacity-text {
        font-size: 9px;
        text-align: center;
        color: #6c757d;
        font-weight: 600;
    }

    .zone-arrow-in, .zone-arrow-out {
        position: absolute;
        font-size: 18px;
        font-weight: 700;
        color: #21A691;
        animation: bounce 2s infinite;
    }

    .zone-arrow-in {
        top: -26px;
        left: 50%;
        transform: translateX(-50%);
    }

    .zone-arrow-out {
        bottom: -26px;
        left: 50%;
        transform: translateX(-50%);
    }

    /* Counter Area */
    .counter-area {
        grid-column: 1 / -1;
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 10px 0;
    }

    .counter-box {
        background: white;
        border: 2px solid #21A691;
        border-radius: 8px;
        padding: 8px 14px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        min-width: 75px;
    }

    .counter-box.active {
        background: linear-gradient(135deg, rgba(33, 166, 145, 0.1) 0%, white 100%);
    }

    .counter-box.inactive {
        border-color: #95a5a6;
        opacity: 0.6;
    }

    .counter-box i {
        font-size: 20px;
        color: #21A691;
        display: block;
        margin-bottom: 4px;
    }

    .counter-box.inactive i {
        color: #95a5a6;
    }

    .counter-box span {
        font-weight: 700;
        font-size: 10px;
        display: block;
        color: #2c3e50;
    }

    /* Map Legend */
    .map-legend {
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        padding: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        margin-top: 12px;
    }

    .legend-title {
        font-weight: 700;
        font-size: 13px;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .legend-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
    }

    .legend-box {
        width: 22px;
        height: 16px;
        border-radius: 3px;
        flex-shrink: 0;
    }

    /* Animations */
    @@keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-6px);
        }
    }

    @@keyframes slide {
        0%, 100% {
            transform: translateX(0);
        }
        50% {
            transform: translateX(6px);
        }
    }

    /* Scrollbar styling */
    .map-container::-webkit-scrollbar {
        width: 8px;
    }

    .map-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .map-container::-webkit-scrollbar-thumb {
        background: #21A691;
        border-radius: 10px;
    }

    .map-container::-webkit-scrollbar-thumb:hover {
        background: #1a8274;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .map-row {
            grid-template-columns: 1fr;
        }

        .map-spacer {
            display: none;
        }

        .road-vertical {
            height: 35px;
            flex-direction: row;
        }

        .counter-area {
            flex-direction: column;
            align-items: center;
        }

        .legend-items {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 576px) {
        .map-container {
            padding: 10px;
        }

        .map-row {
            gap: 8px;
        }

        .legend-items {
            gap: 8px;
        }
    }

    /* Navigation Modal Styles */
    .navigation-map-container {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .navigation-info-bar {
        display: flex;
        justify-content: space-around;
        padding: 12px;
        background: linear-gradient(135deg, #21A691 0%, #1a8274 100%);
        border-radius: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .nav-info-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 13px;
    }

    .nav-info-item i {
        font-size: 16px;
    }

    .navigation-map {
        position: relative;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 2px solid #dee2e6;
        border-radius: 10px;
        height: 500px;
        overflow: hidden;
    }

    .route-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5;
        pointer-events: none;
    }

    .route-path {
        fill: none;
        stroke: #21A691;
        stroke-width: 4;
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawPath 2s ease-in-out forwards;
    }

    .route-arrow {
        fill: #21A691;
        animation: fadeIn 0.5s ease-in-out 2s forwards;
        opacity: 0;
    }

    @@keyframes drawPath {
        to {
            stroke-dashoffset: 0;
        }
    }

    @@keyframes fadeIn {
        to {
            opacity: 1;
        }
    }

    .nav-entry-point {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #87DF2C;
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 13px;
        box-shadow: 0 4px 12px rgba(135, 223, 44, 0.4);
        z-index: 10;
        animation: bounce 2s infinite;
    }

    .nav-zone {
        position: absolute;
        border: 3px solid #21A691;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .nav-zone.highlight {
        border-color: #87DF2C;
        background: rgba(135, 223, 44, 0.1);
        box-shadow: 0 4px 16px rgba(135, 223, 44, 0.4);
        transform: scale(1.05);
    }

    .zone-a-nav {
        top: 80px;
        left: 30px;
        width: 200px;
        height: 150px;
    }

    .zone-b-nav {
        top: 80px;
        right: 30px;
        width: 200px;
        height: 150px;
    }

    .zone-c-nav {
        bottom: 80px;
        left: 30px;
        width: 200px;
        height: 150px;
    }

    .zone-d-nav {
        bottom: 80px;
        right: 30px;
        width: 200px;
        height: 150px;
    }

    .nav-zone-label {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        color: #21A691;
        font-size: 14px;
    }

    .nav-zone-label i {
        font-size: 18px;
    }

    .nav-target-marker {
        position: absolute;
        width: 40px;
        height: 40px;
        z-index: 15;
        animation: markerBounce 1.5s infinite;
    }

    .nav-target-marker i {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 32px;
        color: #e74c3c;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .marker-pulse {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(231, 76, 60, 0.4);
        animation: pulse 2s infinite;
    }

    @@keyframes markerBounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    /* Navigation Steps */
    .navigation-steps-container {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        max-height: 580px;
        overflow-y: auto;
    }

    .steps-title {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .navigation-steps {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .nav-step {
        display: flex;
        gap: 12px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 3px solid #21A691;
        transition: all 0.3s ease;
        animation: slideIn 0.5s ease-out forwards;
        opacity: 0;
    }

    .nav-step:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }

    .nav-step-number {
        width: 30px;
        height: 30px;
        background: linear-gradient(135deg, #21A691 0%, #1a8274 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
    }

    .nav-step-content {
        flex: 1;
    }

    .nav-step-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 4px;
        font-size: 14px;
    }

    .nav-step-description {
        color: #6c757d;
        font-size: 12px;
        line-height: 1.5;
    }

    .nav-step-icon {
        font-size: 24px;
        color: #21A691;
        flex-shrink: 0;
    }

    @@keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Add delay to each step */
    .nav-step:nth-child(1) { animation-delay: 0.1s; }
    .nav-step:nth-child(2) { animation-delay: 0.2s; }
    .nav-step:nth-child(3) { animation-delay: 0.3s; }
    .nav-step:nth-child(4) { animation-delay: 0.4s; }
    .nav-step:nth-child(5) { animation-delay: 0.5s; }
    .nav-step:nth-child(6) { animation-delay: 0.6s; }

    .navigation-legend {
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
    }

    .legend-title-small {
        font-size: 13px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .legend-items-small {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .legend-item-small {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #6c757d;
    }

    /* Responsive Navigation */
    @@media (max-width: 992px) {
        .navigation-map {
            height: 400px;
        }

        .nav-zone {
            width: 150px !important;
            height: 120px !important;
        }

        .navigation-steps-container {
            margin-top: 20px;
            max-height: 400px;
        }
    }

    @@media (max-width: 576px) {
        .navigation-info-bar {
            flex-direction: column;
            align-items: flex-start;
        }

        .navigation-map {
            height: 300px;
        }

        .nav-zone {
            width: 100px !important;
            height: 80px !important;
        }

        .nav-zone-label {
            font-size: 11px;
        }

        .zone-a-nav {
            top: 60px;
            left: 15px;
        }

        .zone-b-nav {
            top: 60px;
            right: 15px;
        }

        .zone-c-nav {
            bottom: 60px;
            left: 15px;
        }

        .zone-d-nav {
            bottom: 60px;
            right: 15px;
        }
    }

    /* Camera View Styles */
    .camera-controls {
        display: flex;
        gap: 8px;
        margin-right: 15px;
    }

    .camera-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        max-height: calc(100vh - 250px);
        overflow-y: auto;
    }

    .camera-feed-container {
        position: relative;
        aspect-ratio: 16/9;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .camera-feed-container:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 20px rgba(33, 166, 145, 0.3);
    }

    .camera-feed {
        width: 100%;
        height: 100%;
        position: relative;
        background: #000;
        border: 2px solid #21A691;
        border-radius: 8px;
        overflow: hidden;
    }

    .camera-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
            to bottom,
            rgba(0,0,0,0.7) 0%,
            rgba(0,0,0,0) 30%,
            rgba(0,0,0,0) 70%,
            rgba(0,0,0,0.7) 100%
        );
        z-index: 2;
        pointer-events: none;
    }

    .camera-label {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
        color: white;
        font-weight: 600;
        font-size: 12px;
        background: rgba(0,0,0,0.5);
        padding: 4px 8px;
        border-radius: 4px;
    }

    .camera-status {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
        color: white;
        font-weight: 600;
        font-size: 11px;
        background: rgba(220, 53, 69, 0.8);
        padding: 4px 8px;
        border-radius: 4px;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #fff;
        animation: pulse 2s infinite;
    }

    .status-dot.recording {
        background: #fff;
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    }

    @@keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    .camera-time {
        position: absolute;
        bottom: 10px;
        right: 10px;
        color: white;
        font-weight: 600;
        font-size: 11px;
        background: rgba(0,0,0,0.5);
        padding: 4px 8px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
    }

    .camera-placeholder {
        width: 100%;
        height: 100%;
        background: #000;
        position: relative;
    }

    .camera-placeholder iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border: none;
    }

    /* Single Camera View */
    .camera-single-view {
        position: relative;
        width: 100%;
        max-height: calc(100vh - 250px);
    }

    .camera-feed-single {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        background: #000;
        border: 3px solid #21A691;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .camera-placeholder-single {
        width: 100%;
        height: 100%;
        position: relative;
    }

    .camera-placeholder-single iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    .camera-single-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
        padding: 15px;
        background: rgba(0,0,0,0.05);
        border-radius: 8px;
    }

    .camera-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Responsive Camera Grid */
    @@media (max-width: 1400px) {
        .camera-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @@media (max-width: 992px) {
        .camera-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @@media (max-width: 576px) {
        .camera-grid {
            grid-template-columns: 1fr;
        }
    }




</style>

<script>
    // Sample data for parking slots
    const parkingData = {
        'A01': { status: 'available', vehicle: null },
        'A02': { status: 'occupied', vehicle: { plate: '29B1-12345', type: 'Xe máy', entryTime: '2025-01-23 08:30' } },
        'A03': { status: 'occupied', vehicle: { plate: '59A1-98765', type: 'Xe máy', entryTime: '2025-01-23 09:15' } },
        'A04': { status: 'available', vehicle: null },
        'A05': { status: 'occupied', vehicle: { plate: '29C1-54321', type: 'Xe máy', entryTime: '2025-01-23 10:00' } },
        'A06': { status: 'available', vehicle: null },
        'A07': { status: 'occupied', vehicle: { plate: '30A-11111', type: 'Xe máy', entryTime: '2025-01-23 07:45' } },
        'A08': { status: 'available', vehicle: null },
        'B01': { status: 'occupied', vehicle: { plate: '30A-56789', type: 'Ô tô 4 chỗ', entryTime: '2025-01-23 08:00' } },
        'B02': { status: 'available', vehicle: null },
        'B03': { status: 'reserved', vehicle: { plate: 'Đã đặt', type: 'Ô tô 4 chỗ', entryTime: 'Dự kiến 14:00' } },
        'B04': { status: 'occupied', vehicle: { plate: '51G-22222', type: 'Ô tô 4 chỗ', entryTime: '2025-01-23 09:30' } },
        'B05': { status: 'available', vehicle: null },
        'B06': { status: 'occupied', vehicle: { plate: '30E-33333', type: 'Ô tô 4 chỗ', entryTime: '2025-01-23 10:15' } },
        'B07': { status: 'maintenance', vehicle: null },
        'B08': { status: 'available', vehicle: null },
        'C01': { status: 'occupied', vehicle: { plate: '30E-77777', type: 'Ô tô 7 chỗ', entryTime: '2025-01-23 07:00' } },
        'C02': { status: 'available', vehicle: null },
        'C03': { status: 'occupied', vehicle: { plate: '51G-88888', type: 'SUV', entryTime: '2025-01-23 09:00' } },
        'C04': { status: 'available', vehicle: null },
        'C05': { status: 'reserved', vehicle: { plate: 'Đã đặt', type: 'Ô tô 7 chỗ', entryTime: 'Dự kiến 15:30' } },
        'C06': { status: 'available', vehicle: null },
        'D01': { status: 'occupied', vehicle: { plate: '51G-99999', type: 'Xe tải', entryTime: '2025-01-23 06:00' } },
        'D02': { status: 'available', vehicle: null },
        'D03': { status: 'occupied', vehicle: { plate: '30E-55555', type: 'Xe tải', entryTime: '2025-01-23 08:30' } },
        'D04': { status: 'available', vehicle: null }
    };

    // Gate status tracking
    const gateStatus = {
        'gate-in-a': { isOpen: true, isMaintenance: false, name: 'Cổng vào A' },
        'gate-in-b': { isOpen: true, isMaintenance: false, name: 'Cổng vào B' },
        'gate-out-a': { isOpen: true, isMaintenance: false, name: 'Cổng ra A' },
        'gate-out-b': { isOpen: true, isMaintenance: false, name: 'Cổng ra B' }
    };

    // Counter status tracking
    const counterStatus = {
        'counter-1': { isActive: true, name: 'Quầy 1' },
        'counter-2': { isActive: true, name: 'Quầy 2' },
        'counter-3': { isActive: false, name: 'Quầy 3' }
    };

    function viewSlotDetails(slotNumber) {
        const slot = parkingData[slotNumber];
        
        if (!slot) return;

        // Check if slot is available - only show notification, don't open modal
        if (slot.status === 'available') {
            // Determine vehicle type from slot number
            let vehicleType = '';
            const zone = slotNumber.charAt(0);
            switch(zone) {
                case 'A':
                    vehicleType = 'Xe máy';
                    break;
                case 'B':
                    vehicleType = 'Ô tô 4 chỗ';
                    break;
                case 'C':
                    vehicleType = 'Ô tô 7 chỗ / SUV';
                    break;
                case 'D':
                    vehicleType = 'Xe tải';
                    break;
            }
            
            showNotification('success', `Vị trí ${slotNumber} đang trống`, 
                `Vị trí này dành cho ${vehicleType}. Bạn có thể đỗ xe tại đây!`);
            return; // Don't open modal for available slots
        }

        // Only show modal for occupied, reserved, or maintenance slots
        document.getElementById('modalSlotNumber').textContent = slotNumber;

        // Status
        let statusBadge = '';
        switch (slot.status) {
            case 'available':
                statusBadge = '<span class="badge badge-success">Trống</span>';
                break;
            case 'occupied':
                statusBadge = '<span class="badge" style="background-color: #ff6b6b; color: white;">Đang đỗ</span>';
                break;
            case 'reserved':
                statusBadge = '<span class="badge badge-warning">Đã đặt</span>';
                break;
            case 'maintenance':
                statusBadge = '<span class="badge" style="background-color: #95a5a6; color: white;">Bảo trì</span>';
                break;
        }
        document.getElementById('modalSlotStatus').innerHTML = statusBadge;

        if (slot.vehicle) {
            document.getElementById('modalVehicleType').textContent = slot.vehicle.type;
            document.getElementById('modalLicensePlate').textContent = slot.vehicle.plate;
            document.getElementById('modalEntryTime').textContent = slot.vehicle.entryTime;
            
            // Calculate duration and fee
            if (slot.status === 'occupied' && slot.vehicle.entryTime !== 'Dự kiến 14:00' && slot.vehicle.entryTime !== 'Dự kiến 15:30') {
                const entryTime = new Date(slot.vehicle.entryTime);
                const now = new Date();
                const duration = Math.floor((now - entryTime) / 1000 / 60 / 60); // hours
                document.getElementById('modalDuration').textContent = duration + ' giờ';
                
                // Simple fee calculation
                let fee = 0;
                if (slot.vehicle.type === 'Xe máy') {
                    fee = duration * 5000;
                } else if (slot.vehicle.type === 'Ô tô 4 chỗ') {
                    fee = duration * 10000;
                } else if (slot.vehicle.type === 'Ô tô 7 chỗ' || slot.vehicle.type === 'SUV') {
                    fee = duration * 15000;
                } else if (slot.vehicle.type === 'Xe tải') {
                    fee = duration * 20000;
                }
                document.getElementById('modalEstimatedFee').textContent = fee.toLocaleString('vi-VN') + ' VNĐ';
            } else {
                document.getElementById('modalDuration').textContent = '-';
                document.getElementById('modalEstimatedFee').textContent = '-';
            }
        } else {
            document.getElementById('modalVehicleType').textContent = '-';
            document.getElementById('modalLicensePlate').textContent = '-';
            document.getElementById('modalEntryTime').textContent = '-';
            document.getElementById('modalDuration').textContent = '-';
            document.getElementById('modalEstimatedFee').textContent = '-';
        }

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('slotDetailsModal'));
        modal.show();
    }

    function toggleGate(gateId, gateName) {
        const gate = gateStatus[gateId];
        if (!gate || gate.isMaintenance) return;

        // Toggle status
        gate.isOpen = !gate.isOpen;

        // Update sidebar UI
        updateGateUI(gateId, gate);
        
        // Update map if modal is open
        updateMapGateStatus();

        // Show notification
        if (gate.isOpen) {
            showNotification('success', `${gateName} đã được mở`, 'Barrier đã được nâng lên');
        } else {
            showNotification('warning', `${gateName} đã được đóng`, 'Barrier đã được hạ xuống');
        }
    }

    function maintenanceGate(gateId, gateName) {
        const gate = gateStatus[gateId];
        if (!gate) return;

        // Toggle maintenance status
        gate.isMaintenance = !gate.isMaintenance;
        
        if (gate.isMaintenance) {
            gate.isOpen = false;
        }

        // Update sidebar UI
        updateGateUI(gateId, gate);
        
        // Update map
        updateMapGateStatus();

        // Show notification
        if (gate.isMaintenance) {
            showNotification('warning', `${gateName} đang bảo trì`, 'Cổng tạm thời không hoạt động');
        } else {
            showNotification('success', `${gateName} đã hoàn tất bảo trì`, 'Cổng sẵn sàng hoạt động');
        }
    }

    function updateGateUI(gateId, gate) {
        const statusElement = document.getElementById(`${gateId}-status`);
        const buttonElement = document.getElementById(`btn-${gateId}`);
        const iconElement = document.getElementById(`${gateId}-icon`);
        const icon = buttonElement.querySelector('i');

        if (gate.isMaintenance) {
            // Maintenance mode
            statusElement.textContent = 'Bảo trì';
            statusElement.className = 'badge badge-warning';
            buttonElement.className = 'btn btn-sm btn-outline-secondary';
            buttonElement.disabled = true;
            iconElement.className = 'gate-icon warning';
        } else if (gate.isOpen) {
            // Open
            statusElement.textContent = 'Đang mở';
            statusElement.className = 'badge badge-success';
            buttonElement.className = 'btn btn-sm btn-outline-danger';
            buttonElement.disabled = false;
            buttonElement.title = 'Đóng cổng';
            icon.className = 'fas fa-lock';
            iconElement.className = 'gate-icon active';
        } else {
            // Closed
            statusElement.textContent = 'Đã đóng';
            statusElement.className = 'badge badge-danger';
            buttonElement.className = 'btn btn-sm btn-outline-success';
            buttonElement.disabled = false;
            buttonElement.title = 'Mở cổng';
            icon.className = 'fas fa-lock-open';
            iconElement.className = 'gate-icon';
        }
    }

    function updateMapGateStatus() {
        // Update gate-in-left (Cổng vào A)
        const gateInLeft = document.querySelector('.gate-in-left');
        if (gateInLeft) {
            updateMapGateElement(gateInLeft, gateStatus['gate-in-a']);
        }

        // Update gate-in-right (Cổng vào B)
        const gateInRight = document.querySelector('.gate-in-right');
        if (gateInRight) {
            updateMapGateElement(gateInRight, gateStatus['gate-in-b']);
        }

        // Update gate-out-left (Cổng ra A)
        const gateOutLeft = document.querySelector('.gate-out-left');
        if (gateOutLeft) {
            updateMapGateElement(gateOutLeft, gateStatus['gate-out-a']);
        }

        // Update gate-out-right (Cổng ra B)
        const gateOutRight = document.querySelector('.gate-out-right');
        if (gateOutRight) {
            updateMapGateElement(gateOutRight, gateStatus['gate-out-b']);
        }
    }

    function updateMapGateElement(element, gateData) {
        // Remove all status classes
        element.classList.remove('maintenance', 'closed');
        
        // Remove existing barrier if any
        const existingBarrier = element.querySelector('.gate-barrier');
        if (existingBarrier) {
            existingBarrier.remove();
        }
        
        if (gateData.isMaintenance) {
            element.classList.add('maintenance');
            const existingSmall = element.querySelector('small');
            if (!existingSmall) {
                const small = document.createElement('small');
                small.textContent = '(Bảo trì)';
                small.style.color = '#ff9800';
                element.appendChild(small);
            }
        } else {
            // Remove maintenance indicator
            const existingSmall = element.querySelector('small');
            if (existingSmall && existingSmall.textContent === '(Bảo trì)') {
                existingSmall.remove();
            }
            
            if (!gateData.isOpen) {
                element.classList.add('closed');
                
                // Add barrier (thanh chắn)
                const barrier = document.createElement('div');
                barrier.className = 'gate-barrier';
                element.appendChild(barrier);
                
                // Add closed text
                const existingSmall = element.querySelector('small');
                if (!existingSmall) {
                    const small = document.createElement('small');
                    small.textContent = '(Đã đóng)';
                    small.style.color = '#e74c3c';
                    element.appendChild(small);
                }
            } else {
                const existingSmall = element.querySelector('small');
                if (existingSmall && existingSmall.textContent === '(Đã đóng)') {
                    existingSmall.remove();
                }
            }
        }
    }

    function toggleCounter(counterId, counterName) {
        const counter = counterStatus[counterId];
        if (!counter) return;

        // Toggle status
        counter.isActive = !counter.isActive;

        // Update UI
        updateCounterUI(counterId, counter);
        
        // Update map
        updateMapCounterStatus();

        // Show notification
        if (counter.isActive) {
            showNotification('success', `${counterName} đã mở`, 'Quầy sẵn sàng phục vụ');
        } else {
            showNotification('info', `${counterName} đã đóng`, 'Quầy tạm ngừng hoạt động');
        }
    }

    function updateCounterUI(counterId, counter) {
        const iconElement = document.getElementById(`${counterId}-icon`);
        const indicatorElement = document.getElementById(`${counterId}-indicator`);
        const textElement = document.getElementById(`${counterId}-text`);
        const buttonElement = document.getElementById(`btn-${counterId}`);
        const buttonIcon = buttonElement.querySelector('i');

        if (counter.isActive) {
            // Active
            iconElement.className = 'counter-icon active';
            indicatorElement.className = 'status-indicator online';
            textElement.textContent = 'Đang hoạt động';
            buttonElement.className = 'btn btn-sm btn-outline-danger';
            buttonElement.title = 'Đóng quầy';
            buttonIcon.className = 'fas fa-times-circle';
        } else {
            // Inactive
            iconElement.className = 'counter-icon inactive';
            indicatorElement.className = 'status-indicator offline';
            textElement.textContent = 'Không hoạt động';
            buttonElement.className = 'btn btn-sm btn-outline-success';
            buttonElement.title = 'Mở quầy';
            buttonIcon.className = 'fas fa-check-circle';
        }
    }

    function updateMapCounterStatus() {
        const counterBoxes = document.querySelectorAll('.counter-box');
        counterBoxes.forEach((box, index) => {
            const counterId = `counter-${index + 1}`;
            const counter = counterStatus[counterId];
            
            if (counter) {
                if (counter.isActive) {
                    box.classList.add('active');
                    box.classList.remove('inactive');
                } else {
                    box.classList.add('inactive');
                    box.classList.remove('active');
                }
            }
        });
    }

    function viewGateCamera(gateId) {
        // Open camera modal
        const modal = new bootstrap.Modal(document.getElementById('cameraViewModal'));
        modal.show();
        
        // Update title based on gate
        const gateName = gateStatus[gateId]?.name || 'Camera';
        document.getElementById('cameraTitle').textContent = gateName;
        
        // Switch to specific camera
        setTimeout(() => {
            switchToSingleCamera(gateId);
        }, 300);
        
        // Start time updates
        startCameraTimeUpdates();
    }

    function openAllCameras() {
        // Open camera modal with all cameras view
        const modal = new bootstrap.Modal(document.getElementById('cameraViewModal'));
        modal.show();
        
        // Show grid view
        document.getElementById('cameraTitle').textContent = 'Tất cả camera';
        document.getElementById('cameraGridView').style.display = 'grid';
        document.getElementById('cameraSingleView').style.display = 'none';
        
        // Start time updates
        startCameraTimeUpdates();
    }

    function navigateToSlot() {
        const slotNumber = document.getElementById('modalSlotNumber').textContent;
        const slot = parkingData[slotNumber];
        
        if (!slot) return;
        
        // Close slot details modal
        const slotModal = bootstrap.Modal.getInstance(document.getElementById('slotDetailsModal'));
        if (slotModal) {
            slotModal.hide();
        }
        
        // Wait a bit for the first modal to close
        setTimeout(() => {
            // Open navigation modal
            showNavigationModal(slotNumber);
        }, 300);
    }

    function showNavigationModal(slotNumber) {
        // Get zone from slot number (A01 -> A, B01 -> B, etc.)
        const zone = slotNumber.charAt(0);
        const slotNum = parseInt(slotNumber.substring(1));
        
        // Update modal title
        document.getElementById('navSlotNumber').textContent = slotNumber;
        document.getElementById('navSlotLocation').textContent = `Khu ${zone} - Vị trí ${slotNumber}`;
        
        // Calculate distance and time based on zone
        const distanceMap = {
            'A': { distance: '45m', time: '1 phút' },
            'B': { distance: '50m', time: '1.5 phút' },
            'C': { distance: '70m', time: '2 phút' },
            'D': { distance: '75m', time: '2.5 phút' }
        };
        
        const zoneInfo = distanceMap[zone] || { distance: '50m', time: '1.5 phút' };
        document.getElementById('navDistance').textContent = zoneInfo.distance;
        document.getElementById('navTime').textContent = zoneInfo.time;
        
        // Position target marker
        positionTargetMarker(zone);
        
        // Draw route
        drawRoute(zone);
        
        // Generate steps
        generateNavigationSteps(zone, slotNumber);
        
        // Highlight target zone
        highlightZone(zone);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('navigationModal'));
        modal.show();
    }

    function positionTargetMarker(zone) {
        const marker = document.getElementById('navTargetMarker');
        const positions = {
            'A': { top: '155px', left: '130px' },
            'B': { top: '155px', right: '130px', left: 'auto' },
            'C': { bottom: '155px', left: '130px', top: 'auto' },
            'D': { bottom: '155px', right: '130px', top: 'auto', left: 'auto' }
        };
        
        const pos = positions[zone];
        if (pos) {
            marker.style.top = pos.top || 'auto';
            marker.style.left = pos.left || 'auto';
            marker.style.right = pos.right || 'auto';
            marker.style.bottom = pos.bottom || 'auto';
        }
    }

    function drawRoute(zone) {
        const svg = document.getElementById('routeSvg');
        svg.innerHTML = ''; // Clear previous routes
        
        // Define paths for each zone
        const paths = {
            'A': 'M 50% 20 L 50% 120 L 130 155',
            'B': 'M 50% 20 L 50% 120 L 70% 155',
            'C': 'M 50% 20 L 50% 280 L 130 345',
            'D': 'M 50% 20 L 50% 280 L 70% 345'
        };
        
        // Create path element
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', paths[zone] || paths['A']);
        path.setAttribute('class', 'route-path');
        path.setAttribute('stroke', '#21A691');
        path.setAttribute('stroke-width', '4');
        path.setAttribute('fill', 'none');
        
        svg.appendChild(path);
        
        // Add animated dots along the path
        addAnimatedDots(svg, paths[zone]);
    }

    function addAnimatedDots(svg, pathData) {
        // Create 3 animated dots that move along the path
        for (let i = 0; i < 3; i++) {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('r', '4');
            circle.setAttribute('fill', '#87DF2C');
            circle.setAttribute('opacity', '0.8');
            
            // Create animateMotion for the dot
            const animateMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
            animateMotion.setAttribute('dur', '3s');
            animateMotion.setAttribute('repeatCount', 'indefinite');
            animateMotion.setAttribute('begin', `${i * 1}s`);
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData);
            
            animateMotion.appendChild(path);
            circle.appendChild(animateMotion);
            svg.appendChild(circle);
        }
    }

    function generateNavigationSteps(zone, slotNumber) {
        const stepsContainer = document.getElementById('navigationSteps');
        stepsContainer.innerHTML = '';
        
        // Define steps based on zone
        const stepsMap = {
            'A': [
                { icon: 'fa-door-open', title: 'Bắt đầu từ cổng vào chính', description: 'Đi qua cổng vào A hoặc B' },
                { icon: 'fa-arrow-right', title: 'Đi thẳng vào trong', description: 'Di chuyển thẳng theo đường chính khoảng 30m' },
                { icon: 'fa-arrow-left', title: 'Rẽ trái vào Khu A', description: 'Rẽ trái khi thấy biển chỉ dẫn "Khu A - Xe máy"' },
                { icon: 'fa-motorcycle', title: `Tìm vị trí ${slotNumber}`, description: 'Vị trí đỗ nằm ở phía bên trái, hàng thứ ' + Math.ceil(parseInt(slotNumber.substring(1)) / 10) },
                { icon: 'fa-check-circle', title: 'Đỗ xe và hoàn tất', description: 'Đỗ xe vào vị trí, nhớ khóa xe và giữ vé' }
            ],
            'B': [
                { icon: 'fa-door-open', title: 'Bắt đầu từ cổng vào chính', description: 'Đi qua cổng vào A hoặc B' },
                { icon: 'fa-arrow-right', title: 'Đi thẳng vào trong', description: 'Di chuyển thẳng theo đường chính khoảng 30m' },
                { icon: 'fa-arrow-right', title: 'Rẽ phải vào Khu B', description: 'Rẽ phải khi thấy biển chỉ dẫn "Khu B - Ô tô 4 chỗ"' },
                { icon: 'fa-car', title: `Tìm vị trí ${slotNumber}`, description: 'Vị trí đỗ nằm ở phía bên phải, hàng thứ ' + Math.ceil(parseInt(slotNumber.substring(1)) / 5) },
                { icon: 'fa-check-circle', title: 'Đỗ xe và hoàn tất', description: 'Đỗ xe vào vị trí, nhớ khóa xe và giữ vé' }
            ],
            'C': [
                { icon: 'fa-door-open', title: 'Bắt đầu từ cổng vào chính', description: 'Đi qua cổng vào A hoặc B' },
                { icon: 'fa-arrow-down', title: 'Đi thẳng qua quầy thu phí', description: 'Di chuyển thẳng qua khu vực quầy thu phí' },
                { icon: 'fa-arrow-left', title: 'Rẽ trái vào Khu C', description: 'Rẽ trái khi thấy biển chỉ dẫn "Khu C - Ô tô 7 chỗ"' },
                { icon: 'fa-shuttle-van', title: `Tìm vị trí ${slotNumber}`, description: 'Vị trí đỗ nằm ở phía bên trái, hàng thứ ' + Math.ceil(parseInt(slotNumber.substring(1)) / 4) },
                { icon: 'fa-check-circle', title: 'Đỗ xe và hoàn tất', description: 'Đỗ xe vào vị trí, nhớ khóa xe và giữ vé' }
            ],
            'D': [
                { icon: 'fa-door-open', title: 'Bắt đầu từ cổng vào chính', description: 'Đi qua cổng vào A hoặc B' },
                { icon: 'fa-arrow-down', title: 'Đi thẳng qua quầy thu phí', description: 'Di chuyển thẳng qua khu vực quầy thu phí' },
                { icon: 'fa-arrow-right', title: 'Rẽ phải vào Khu D', description: 'Rẽ phải khi thấy biển chỉ dẫn "Khu D - Xe tải"' },
                { icon: 'fa-truck', title: `Tìm vị trí ${slotNumber}`, description: 'Vị trí đỗ nằm ở phía bên phải, hàng thứ ' + Math.ceil(parseInt(slotNumber.substring(1)) / 4) },
                { icon: 'fa-check-circle', title: 'Đỗ xe và hoàn tất', description: 'Đỗ xe vào vị trí, nhớ khóa xe và giữ vé' }
            ]
        };
        
        const steps = stepsMap[zone] || stepsMap['A'];
        
        steps.forEach((step, index) => {
            const stepElement = document.createElement('div');
            stepElement.className = 'nav-step';
            stepElement.innerHTML = `
                <div class="nav-step-number">${index + 1}</div>
                <div class="nav-step-icon">
                    <i class="fas ${step.icon}"></i>
                </div>
                <div class="nav-step-content">
                    <div class="nav-step-title">${step.title}</div>
                    <div class="nav-step-description">${step.description}</div>
                </div>
            `;
            stepsContainer.appendChild(stepElement);
        });
    }

    function highlightZone(zone) {
        // Remove previous highlights
        document.querySelectorAll('.nav-zone').forEach(el => {
            el.classList.remove('highlight');
        });
        
        // Add highlight to target zone
        const targetZone = document.querySelector(`.zone-${zone.toLowerCase()}-nav`);
        if (targetZone) {
            setTimeout(() => {
                targetZone.classList.add('highlight');
            }, 2000); // Highlight after route animation
        }
    }

    function printNavigation() {
        window.print();
    }

    // Clean up when navigation modal closes
    document.getElementById('navigationModal')?.addEventListener('hidden.bs.modal', function () {
        const svg = document.getElementById('routeSvg');
        if (svg) {
            svg.innerHTML = '';
        }
        
        document.querySelectorAll('.nav-zone').forEach(el => {
            el.classList.remove('highlight');
        });
    });

    function refreshParkingLot() {
        // Simulate refresh
        const slots = document.querySelectorAll('.parking-slot');
        slots.forEach(slot => {
            slot.style.opacity = '0.5';
        });

        setTimeout(() => {
            slots.forEach(slot => {
                slot.style.opacity = '1';
            });
            showNotification('success', 'Đã cập nhật', 'Trạng thái bãi đỗ đã được làm mới');
        }, 500);
    }

    function showOverviewMap() {
        const modal = new bootstrap.Modal(document.getElementById('overviewMapModal'));
        modal.show();
        // Update map status when opening
        updateMapGateStatus();
        updateMapCounterStatus();
    }

    function printOverviewMap() {
        window.print();
    }

    function showNotification(type, title, message) {
        // Simple notification (in real app, use a library like toastr)
        const bgColors = {
            'success': '#87DF2C',
            'warning': '#ff9800',
            'danger': '#e74c3c',
            'info': '#21A691'
        };

        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            min-width: 300px;
            border-left: 4px solid ${bgColors[type] || '#21A691'};
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: start; gap: 12px;">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'danger' ? 'times-circle' : 'info-circle'}" 
                   style="color: ${bgColors[type] || '#21A691'}; font-size: 20px; margin-top: 2px;"></i>
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: 4px;">${title}</div>
                    <div style="font-size: 13px; color: #6c757d;">${message}</div>
                </div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transition = 'opacity 0.3s ease';
            notification.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // Fullscreen mode toggle
    function toggleFullscreenMode() {
        const icon = document.getElementById('fullscreenIcon');
        const text = document.getElementById('fullscreenText');
        
        if (!document.fullscreenElement) {
            // Enter fullscreen
            document.documentElement.requestFullscreen().then(() => {
                icon.className = 'fas fa-compress-arrows-alt';
                text.textContent = 'Thoát toàn màn hình';
                showNotification('success', 'Chế độ toàn màn hình', 'Đã bật chế độ toàn màn hình');
            }).catch(err => {
                console.error('Error attempting to enable fullscreen:', err);
                showNotification('danger', 'Lỗi', 'Không thể bật chế độ toàn màn hình');
            });
        } else {
            // Exit fullscreen
            document.exitFullscreen().then(() => {
                icon.className = 'fas fa-expand-arrows-alt';
                text.textContent = 'Toàn màn hình';
                showNotification('info', 'Chế độ thường', 'Đã thoát chế độ toàn màn hình');
            }).catch(err => {
                console.error('Error attempting to exit fullscreen:', err);
            });
        }
    }

    // Listen for fullscreen changes (e.g., when user presses ESC)
    document.addEventListener('fullscreenchange', function() {
        const icon = document.getElementById('fullscreenIcon');
        const text = document.getElementById('fullscreenText');
        
        if (!document.fullscreenElement) {
            icon.className = 'fas fa-expand-arrows-alt';
            text.textContent = 'Toàn màn hình';
        } else {
            icon.className = 'fas fa-compress-arrows-alt';
            text.textContent = 'Thoát toàn màn hình';
        }
    });

    // Auto refresh every 30 seconds
    setInterval(() => {
        // In real implementation, fetch fresh data from API
        console.log('Auto refreshing parking data...');
    }, 30000);

    // View mode toggle
    let isCompactView = false;

    function toggleViewMode() {
        isCompactView = !isCompactView;
        
        const detailView = document.getElementById('detailView');
        const compactView = document.getElementById('compactView');
        const viewModeIcon = document.getElementById('viewModeIcon');
        const viewModeText = document.getElementById('viewModeText');
        
        if (isCompactView) {
            // Switch to compact view
            detailView.style.display = 'none';
            compactView.style.display = 'block';
            viewModeIcon.className = 'fas fa-expand-alt';
            viewModeText.textContent = 'Chế độ chi tiết';
            showNotification('info', 'Chế độ rút gọn', 'Đã chuyển sang chế độ xem rút gọn');
        } else {
            // Switch to detail view
            detailView.style.display = 'block';
            compactView.style.display = 'none';
            viewModeIcon.className = 'fas fa-compress-alt';
            viewModeText.textContent = 'Chế độ rút gọn';
            showNotification('info', 'Chế độ chi tiết', 'Đã chuyển sang chế độ xem chi tiết');
        }
    }

    function toggleCompactSection(sectionId, event) {
        // Prevent default and stop propagation
        if (event) {
            event.stopPropagation();
        }
        
        const section = document.getElementById(sectionId);
        if (!section) return;
        
        const expandedContent = section.querySelector('.compact-section-expanded');
        const expandBtn = section.querySelector('.compact-expand-btn');
        
        // Check if already expanded
        const isExpanded = section.classList.contains('expanded');
        
        // Collapse all other sections first
        document.querySelectorAll('.compact-section').forEach(s => {
            if (s.id !== sectionId) {
                s.classList.remove('expanded');
                const content = s.querySelector('.compact-section-expanded');
                const btn = s.querySelector('.compact-expand-btn');
                if (content) content.style.display = 'none';
                if (btn) btn.querySelector('i').style.transform = '';
            }
        });
        
        // Toggle current section
        if (isExpanded) {
            // Collapse
            section.classList.remove('expanded');
            if (expandedContent) expandedContent.style.display = 'none';
            if (expandBtn) expandBtn.querySelector('i').style.transform = '';
            showNotification('info', 'Đã thu gọn', `Đã thu gọn ${section.querySelector('.compact-section-title').textContent}`);
        } else {
            // Expand
            section.classList.add('expanded');
            if (expandedContent) {
                expandedContent.style.display = 'block';
                // Smooth scroll to section
                setTimeout(() => {
                    section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
            if (expandBtn) expandBtn.querySelector('i').style.transform = 'rotate(180deg)';
            showNotification('success', 'Đã mở rộng', `Hiển thị chi tiết ${section.querySelector('.compact-section-title').textContent}`);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Set initial gate UI
        Object.keys(gateStatus).forEach(gateId => {
            updateGateUI(gateId, gateStatus[gateId]);
        });
        
        // Set initial counter UI
        Object.keys(counterStatus).forEach(counterId => {
            updateCounterUI(counterId, counterStatus[counterId]);
        });
        
        console.log('VehicleVision initialized');
    });

    // Camera Functions - CCTV Parking Lot Surveillance Videos
    const cameraVideoUrls = {
        // Cổng vào - Parking Entrance Gates
        'gate-in-a': 'https://www.youtube.com/embed/5_XSYlAfJZM?autoplay=1&mute=1&loop=1&playlist=5_XSYlAfJZM&controls=0&modestbranding=1&rel=0',
        'gate-in-b': 'https://www.youtube.com/embed/Vrxyr1CjiSM?autoplay=1&mute=1&loop=1&playlist=Vrxyr1CjiSM&controls=0&modestbranding=1&rel=0',
        
        // Cổng ra - Parking Exit Gates
        'gate-out-a': 'https://www.youtube.com/embed/CevxZvSJLk8?autoplay=1&mute=1&loop=1&playlist=CevxZvSJLk8&controls=0&modestbranding=1&rel=0',
        'gate-out-b': 'https://www.youtube.com/embed/jmRfToI-cC4?autoplay=1&mute=1&loop=1&playlist=jmRfToI-cC4&controls=0&modestbranding=1&rel=0',
        
        // Khu xe máy - Motorcycle Parking Area
        'area-a': 'https://www.youtube.com/embed/l_MyUGq7pgs?autoplay=1&mute=1&loop=1&playlist=l_MyUGq7pgs&controls=0&modestbranding=1&rel=0',
        
        // Khu ô tô - Car Parking Areas
        'area-b': 'https://www.youtube.com/embed/MNn9qKG2UFI?autoplay=1&mute=1&loop=1&playlist=MNn9qKG2UFI&controls=0&modestbranding=1&rel=0',
        'area-c': 'https://www.youtube.com/embed/NyLF8nHIquM?autoplay=1&mute=1&loop=1&playlist=NyLF8nHIquM&controls=0&modestbranding=1&rel=0',
        'area-d': 'https://www.youtube.com/embed/1-b7RmmeLtk?autoplay=1&mute=1&loop=1&playlist=1-b7RmmeLtk&controls=0&modestbranding=1&rel=0'
    };

    const cameraNames = {
        'gate-in-a': { name: 'Cổng vào A', icon: 'fa-sign-in-alt' },
        'gate-in-b': { name: 'Cổng vào B', icon: 'fa-sign-in-alt' },
        'gate-out-a': { name: 'Cổng ra A', icon: 'fa-sign-out-alt' },
        'gate-out-b': { name: 'Cổng ra B', icon: 'fa-sign-out-alt' },
        'area-a': { name: 'Khu A - Xe máy', icon: 'fa-motorcycle' },
        'area-b': { name: 'Khu B - Ô tô 4 chỗ', icon: 'fa-car' },
        'area-c': { name: 'Khu C - Ô tô 7 chỗ', icon: 'fa-shuttle-van' },
        'area-d': { name: 'Khu D - Xe tải', icon: 'fa-truck' }
    };

    let cameraTimeInterval = null;

    function switchToSingleCamera(cameraId) {
        // Hide grid view
        document.getElementById('cameraGridView').style.display = 'none';
        
        // Show single view
        document.getElementById('cameraSingleView').style.display = 'block';
        
        // Update camera info
        const cameraInfo = cameraNames[cameraId];
        if (cameraInfo) {
            document.getElementById('single-camera-name').textContent = cameraInfo.name;
            document.getElementById('single-camera-icon').className = `fas ${cameraInfo.icon}`;
            document.getElementById('cameraTitle').textContent = cameraInfo.name;
        }
        
        // Load video
        const videoUrl = cameraVideoUrls[cameraId];
        const content = document.getElementById('single-camera-content');
        content.innerHTML = `
            <iframe width="100%" height="100%" 
                src="${videoUrl}&controls=1" 
                frameborder="0" 
                allow="autoplay; encrypted-media" 
                allowfullscreen>
            </iframe>
        `;
    }

    function switchCameraView(mode) {
        if (mode === 'all') {
            // Show grid view
            document.getElementById('cameraGridView').style.display = 'grid';
            document.getElementById('cameraSingleView').style.display = 'none';
            document.getElementById('cameraTitle').textContent = 'Tất cả camera';
        }
    }

    function refreshCameras() {
        // Simulate refresh
        showNotification('info', 'Đang làm mới', 'Cập nhật feed camera...');
        
        // Reload all iframes
        const iframes = document.querySelectorAll('.camera-placeholder iframe, .camera-placeholder-single iframe');
        iframes.forEach(iframe => {
            const src = iframe.src;
            iframe.src = '';
            setTimeout(() => {
                iframe.src = src;
            }, 100);
        });
        
        setTimeout(() => {
            showNotification('success', 'Đã cập nhật', 'Tất cả camera đã được làm mới');
        }, 500);
    }

    function toggleFullscreen() {
        const modal = document.getElementById('cameraViewModal');
        if (!document.fullscreenElement) {
            modal.requestFullscreen().catch(err => {
                console.error('Error attempting to enable fullscreen:', err);
            });
        } else {
            document.exitFullscreen();
        }
    }

    function captureSnapshot() {
        showNotification('success', 'Đã chụp ảnh', 'Ảnh đã được lưu vào thư mục Snapshots');
        
        // In real implementation, capture current frame from video
        // For now, just show notification
    }

    function toggleRecording() {
        const btn = event.currentTarget;
        const icon = btn.querySelector('i');
        
        if (icon.classList.contains('fa-circle')) {
            // Start recording
            icon.classList.remove('fa-circle');
            icon.classList.add('fa-stop');
            btn.classList.remove('btn-outline-light');
            btn.classList.add('btn-danger');
            showNotification('info', 'Bắt đầu ghi hình', 'Đang ghi video...');
        } else {
            // Stop recording
            icon.classList.remove('fa-stop');
            icon.classList.add('fa-circle');
            btn.classList.remove('btn-danger');
            btn.classList.add('btn-outline-light');
            showNotification('success', 'Đã dừng ghi hình', 'Video đã được lưu');
        }
    }

    function toggleSound() {
        const btn = event.currentTarget;
        const icon = btn.querySelector('i');
        
        if (icon.classList.contains('fa-volume-up')) {
            // Mute
            icon.classList.remove('fa-volume-up');
            icon.classList.add('fa-volume-mute');
            showNotification('info', 'Đã tắt âm thanh', '');
        } else {
            // Unmute
            icon.classList.remove('fa-volume-mute');
            icon.classList.add('fa-volume-up');
            showNotification('info', 'Đã bật âm thanh', '');
        }
    }

    function startCameraTimeUpdates() {
        // Clear existing interval
        if (cameraTimeInterval) {
            clearInterval(cameraTimeInterval);
        }
        
        // Update time every second
        cameraTimeInterval = setInterval(() => {
            const now = new Date();
            const timeString = now.toLocaleTimeString('vi-VN', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            const dateString = now.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            // Update all camera times
            document.querySelectorAll('.camera-time').forEach(el => {
                el.textContent = `${dateString} ${timeString}`;
            });
        }, 1000);
    }

    // Stop time updates when modal is closed
    document.getElementById('cameraViewModal')?.addEventListener('hidden.bs.modal', function () {
        if (cameraTimeInterval) {
            clearInterval(cameraTimeInterval);
            cameraTimeInterval = null;
        }
        
        // Reset to grid view
        switchCameraView('all');
    });

</script>
